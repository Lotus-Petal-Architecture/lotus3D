//Copyright 2022 by Lotus.fm LLC, 2000_view

var camera, scene, raycaster, renderer, parentTransform
var mouse = new THREE.Vector2()
var r = 100,
  dot = 0

  var scene = new THREE.Scene()

  var camera = new THREE.PerspectiveCamera(  
    7.7, // This variable controls size -- the lower the value the larger the rendering. Original value was 27.
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  )

  var container = document.getElementById('container')

  containerWidth = window.innerWidth
  containerHeight = window.innerHeight

  renderer = new THREE.WebGLRenderer({ antialias: true })
  renderer.setPixelRatio(window.devicePixelRatio)
  renderer.setSize(window.innerWidth, window.innerHeight)
  document.body.appendChild(renderer.domElement)

  var controls = new THREE.OrbitControls(camera, renderer.domElement)
  controls.minDistance = 0
  controls.maxDistance = 100
  controls.maxPolarAngle = Math.PI / 2
  controls.addEventListener( 'change', () => renderer.render( scene, camera ) );


  var light = new THREE.PointLight(0xffffff)
  light.position.set(-100, 200, 100)
  scene.add(light)

  var group
  group = new THREE.Group()
  group.position.set( 0, -.08, -5);
  group.rotation.set(1,0,0);
  scene.add(group)

  var link_order_length = 0


 


  var link_order = [] // list of all link values in the module, with k values assigned to each index position
  var k_values = [] // list of all k values generated for corresponding module chart lines
  var active_links = [] //index values of active links
  var active_links2 = [] //index values of active links
var time = '15:58 EST'
var date = '2024/02/08'
var symbols = ['TSLA','PYPL','F','DIS','T','DISH','AMD','CMCSA','NVDA','AMZN','AAPL','BAC','AAL','INTC','PFE','CCL','PCG','GOOGL','WBD','VZ','META','XOM','ABMD','GOOG','KMI','MSFT','C','GM','MO','LUMN','MRO','CSCO','PARA','FCX','BMY','SLB','AMCR','KEY','KO','MU','DVN','HBAN','KHC','LUV','CVS','WFC','VFC','NWSA','NCLH','TPR','SBUX','PM','BKR','JNJ','CVX','FTNT','NEE','ON','CSX','PEP','GILD','OXY','BAX','QCOM','NEM','USB','COP','BWA','FOXA','WBA','ENPH','UAL','HPE','DAL','IPG','TFC','BSX','WYNN','RF','KIM','PEAK','K','APA','WMB','VTRS','NKE','AES','TJX','LVS','BA','MS','MAS','KR','MDT','EXPE','ABT','KDP','DUK','AMGN','ICE','AMAT','DXC','SCHW','CARR','EMR','CTLT','IP','MCHP','HSY','RTX','HAL','EXC','MGM','AIG','CTRA','MTCH','JCI','ABBV','CTVA','JPM','MRK','MRNA','NWL','RL','MDLZ','PG','IBM','SYY','ZBH','LLY','EL','WMT','FE','ORCL','MCD','DXCM','WRK','HPQ','O','AXP','GIS','ALL','CRM','V','D','MNST','WDC','EQT','MMM','TMUS','CL','VICI','SPGI','CFG','PSX','CAG','SO','GLW','EVRG','UDR','APTV','EW','NFLX','HES','GE','HRL','PPL','NI','LNC','AEP','ADM','CDAY','MET','MOS','ES','UNH','EBAY','CNC','EOG','CTSH','CZR','FITB','DOW','UPS','APD','IVZ','HST','CHTR','DD','BRK-B','TGT','TTWO','SYF','TXN','ZION','BK','OMC','XRAY','RCL','PEG','FMC','ANET','AVGO','FAST','VLO','PLD','CNP','XEL','ILMN','MCK','EIX','OGN','HON','NWS','ALB','IR','CAH','ROL','WY','TAP','ADI','BEN','FOX','OKE','NRG','CSGP','CPB','NXPI','ROK','STT','HWM','SEDG','TROW','HD','EFX','WEC','FIS','BBWI','ETSY','CMS','KMB','HSIC','FDX','XYL','PAYC','YUM','LOW','UNP','CCI','DHI','CME','WELL','DLTR','JNPR','APH','TSN','CPRT','DTE','LYV','AFL','COST','BBY','CAT','FANG','DLR','PCAR','CHRW','PRU','HUM','ALK','DHR','MA','HOLX','STX','PGR','INVH','PXD','MPWR','BDX','CBRE','LYB','ADBE','GS','TMO','AMT','VTR','BALL','EA','FLT','TER','CDNS','AKAM','ACN','MPC','HAS','TT','COF','HLT','VNO','ETN','SRE','MAA','AEE','CB','DG','CMA','PNC','ZTS','SWKS','ED','KMX','LIN','MKC','SNPS','CI','IFF','INCY','LNT','CHD','SEE','ROST','VRTX','HIG','SBAC','PHM','FTV','DFS','OTIS','PNW','A','REG','TXT','BRO','AAP','GPC','NTAP','SYK','TEL','CEG','LW','NDAQ','LEN','PPG','CPT','DE','QRVO','ALGN','SHW','WAB','TSCO','LKQ','WM','EMN','EQR','MMC','RSG','SPG','SWK','ETR','ARE','TRV','MHK','BXP','MTB','WRB','ADP','DOV','MAR','INTU','DGX','CLX','PAYX','GPN','CF','CDW','NSC','LMT','CINF','ISRG','STZ','TRMB','NOW','AON','MSI','L','WHR','LHX','HCA','FRT','NUE','KEYS','RMD','EXPD','BF-B','AME','NTRS','PNR','ORLY','PFG','IQV','SJM','MOH','VMC','AWK','SNA','TECH','GL','GNRC','LRCX','ELV','STE','JBHT','PWR','AOS','ALLE','VRSN','EXR','J','AVB','ADSK','AJG','ATO','MCO','ULTA','RHI','ECL','LDOS','ITW','ODFL','RJF','EPAM','CMI','IEX','IRM','BIIB','VRSK','JKHY','KLAC','DVA','GD','LH','URI','DPZ','GRMN','DRI','BR','ROP','PTC','IDXX','TDG','REGN','NOC','PKG','IT','WTW','PH','CRL','CE','ESS','PSA','CBOE','MSCI','ANSS','BKNG','EQIX','CMG','MKTX','AIZ','BLK','UHS','WAT','WST','FFIV','AVY','MLM','AZO','ZBRA','POOL','AMP','CTAS','NDSN','HII','MTD','FDS','GWW','COO','TDY','BIO','TYL','TFX','SBNY','NVR','TWTR','SIVB','RE','PKI','NLSN','NLOK','FRC','FISV',]
var price = ['189.53','56.095','12.8025','110.345','16.84','5.77','169.27','41.265','696.435','169.6975','188.155','33.131','14.955','42.495','27.545','15.68','16.225','145.82','9.82','39.88','469.675','103.86','381.02','147.09','16.62','413.68','54.325','38.64','40.055','1.5','22.69','49.92','13.025','38.115','48.74','47.715','9.16','13.85','59.785','84.92','42.385','12.31','36.455','32.305','75.045','48.325','15.37','25.83','17.5','42.825','96.615','88.97','29.295','156.28','153.75','67.855','56.255','80.68','37.04','173.87','73.79','58.09','40.465','148.2','33.365','40.33','113.94','31.41','28.795','22.52','116.965','41.605','15.465','40.365','31.78','35.465','65.005','106.0','17.87','19.98','17.95','54.78','30.46','34.055','11.53','103.58','16.21','98.36','53.615','209.1796','85.585','73.335','45.37','86.23','159.26','112.155','31.485','92.575','294.815','134.0','173.87','22.06','62.4','54.985','102.305','56.595','34.859','84.355','202.48','91.13','34.9922','33.745','46.355','68.41','24.51','35.005','55.17','174.74','53.315','174.61','126.485','93.63','8.445','171.5','74.73','158.46','184.2202','79.165','123.21','734.95','140.635','169.285','35.805','116.62','292.14','126.98','42.7856','28.245','53.105','210.955','64.035','161.7','291.9','275.775','44.24','56.4575','57.085','34.735','93.2','160.84','84.13','29.61','436.44','31.35','146.84','28.09','66.96','31.715','48.62','35.535','81.31','85.88','558.335','146.35','139.035','29.425','25.62','25.035','26.335','75.9','52.67','69.52','66.74','30.085','54.005','520.03','42.005','76.54','112.91','78.295','44.23','33.365','53.855','147.98','219.7','15.9','19.53','282.14','67.13','397.22','147.13','169.5','38.865','160.19','39.835','55.14','86.6','33.13','121.03','58.135','52.14','275.665','1274.24','69.25','141.7925','131.54','27.4','57.985','143.5','494.65','64.61','16.285','193.43','27.02','114.19','85.25','102.74','43.765','33.035','60.285','194.11','26.79','26.615','68.95','52.415','81.69','43.165','227.91','278.54','72.38','59.18','75.17','108.93','363.45','252.06','77.41','61.47','44.445','74.46','56.24','120.155','74.79','241.82','122.25','196.135','130.56','220.43','248.66','107.35','144.72','203.98','87.05','140.92','36.945','104.82','53.86','50.9087','104.0','88.015','78.08','723.58','75.54','321.66','153.29','147.09','105.65','74.64','108.52','367.22','36.43','245.82','458.41','73.461','87.655','182.88','32.64','231.39','736.84','240.66','85.985','94.96','615.49','384.615','550.3575','193.96','45.55','59.22','138.84','265.025','98.45','307.12','126.725','368.01','169.5','50.655','269.82','135.23','194.26','26.42','272.9','69.81','124.44','67.89','244.35','135.67','50.99','147.692','195.67','104.67','88.64','73.2292','414.32','65.835','571.77','332.5','80.58','57.36','47.46','99.921','35.115','146.01','422.76','89.65','216.3','103.26','82.205','108.76','90.95','66.26','134.08','62.14','87.58','79.87','64.24','142.255','88.83','338.94','143.14','130.59','100.891','56.74','153.33','138.655','94.025','385.925','112.7','294.91','312.27','136.63','231.84','47.515','189.61','83.01','59.15','196.605','174.7','143.94','89.245','97.41','117.9','213.38','109.965','65.015','131.61','79.765','251.03','159.93','249.54','652.52','126.525','154.38','122.73','136.65','76.42','243.75','254.04','426.9','107.55','386.875','242.555','52.02','798.53','306.465','328.09','72.04','110.2','209.16','305.62','102.095','186.24','161.06','183.835','127.33','57.005','166.185','78.405','74.27','1021.025','77.695','216.75','131.05','380.92','238.79','121.971','266.485','67.925','124.78','127.37','864.04','502.22','220.52','213.37','207.64','80.32','130.5','200.77','143.55','143.15','174.54','261.44','237.2','112.88','398.29','518.73','80.535','202.665','113.255','254.47','434.585','111.95','286.845','250.18','225.445','68.58','240.22','249.16','174.16','618.36','110.92','268.91','222.715','647.04','426.84','122.29','168.35','198.9','545.06','181.38','572.83','1129.28','946.31','451.7','166.87','455.309','269.82','515.09','218.76','148.965','229.325','285.25','184.69','586.065','345.015','3836.25','854.81','2619.78','224.04','174.7','792.7','162.015','326.5','410.595','185.14','202.61','526.095','2733.22','247.03','387.245','394.31','617.035','261.795','272.415','1224.58','469.73','950.78','373.15','430.585','326.445','435.28','251.04','1.0','7489.79','nan','nan','nan','nan','nan','nan','nan','nan',]
var change = ['1.949997','-7.1450005','0.0024995804','11.205002','-0.48999977','0.11000013','-1.6699982','-1.5950012','-4.5549927','-0.8325043','-1.2550049','-0.048999786','0.045000076','-0.28499985','-0.01499939','-0.03999996','-0.18499947','0.28001404','0.069999695','-0.5399971','0.084991455','1.6399994','0.0','0.41000366','-0.02999878','-0.36999512','-0.21500015','-0.08000183','-0.20499802','0.049999952','0.0','0.14999771','0.17499924','-1.0849991','0.10000229','0.2649994','-0.22000027','-0.049999237','-0.20500183','-0.25','1.074997','-0.03999996','0.055000305','1.5650005','-1.0050049','-0.15499878','0.059999466','1.5599995','0.11000061','2.4750023','1.875','-2.4700012','0.17499924','-1.699997','1.6199951','-2.1749954','-0.125','3.7200012','0.049999237','2.399994','-0.62999725','0.47000122','1.0849991','2.3099976','-0.28499985','0.42000198','1.6200027','-2.420002','-0.67499924','-0.289999','-0.5450058','0.32500076','0.20499992','0.1550026','-0.460001','-0.025001526','-0.2250061','6.169998','0.030000687','-0.19000053','0.07999992','1.0900002','-0.09000015','-0.23500061','-0.21000004','-0.20999908','-0.11000061','0.5299988','0.8650017','-2.7404022','-0.41500092','2.8949966','0.75','-0.9300003','4.8799896','-1.1549988','0.22500038','-2.925003','-1.0549927','5.919998','2.9700012','0.6899986','0.22000122','1.1549988','-1.784996','0.09500122','0.99900055','1.0450058','8.220001','-0.80000305','0.25219727','-0.35499954','1.6349983','-1.3999939','0.14999962','0.18500137','0.76999664','-0.269989','-0.75500107','-0.81999207','-0.9850006','-5.670006','0.5249996','24.36','0.11000061','-0.6599884','2.1401978','-0.50499725','-4.340004','9.570007','-1.2949982','-0.09500122','-0.025001526','-0.6499939','4.810028','0.37000275','3.1680984','0.29500008','-0.25500107','1.875','0.32500458','3.0999908','3.0599976','-3.0950012','-0.25','-0.0024986267','-0.85499954','0.50500107','-0.6399994','-0.94000244','0.26999664','-0.09000015','-23.279999','0.040000916','0.30999756','-0.27000046','0.010002136','-0.07500076','-0.76000214','0.21500015','-0.7099991','-0.73000336','-0.9649658','1.1500092','0.53500366','-0.3050003','-0.059999466','-0.055000305','-0.74500084','-0.5499954','-0.2100029','0.0699997','-0.26000214','-0.28500175','0.21500015','0.64001465','-0.33499908','1.6200027','0.39000702','0.29499817','1.1599998','0.005001068','-0.23500061','0.73999023','4.319992','-0.020000458','0.30000114','-1.5299988','0.6499939','-0.44000244','0.40000916','-0.070007324','0.3350029','1.4199982','0.64500046','-0.13000107','0.27999878','-0.579998','1.5999985','-0.875','-2.5100021','8.615021','17.179932','-0.20999908','0.61250305','2.449997','-0.17000008','-0.38499832','0.55999756','-22.329987','-0.83000183','0.034999847','-0.6700134','1.7200012','-0.8600006','0.6800003','-2.9300003','-0.43500137','0.17499924','0.5550003','2.1399994','0.0700016','-0.82500076','0.40999603','-0.57500076','-3.4399948','-0.46500015','6.5400085','9.52002','-0.6500015','0.13999939','-1.0100021','-0.80000305','0.76000977','10.199997','-0.75','-0.19999695','0.35499954','1.199997','-0.16999817','-0.9150009','-0.47000122','-0.30999756','-1.0999985','-2.8950043','0.91999817','-1.2600098','-0.5','0.47999573','0.08000183','-1.480011','0.29000092','1.0899963','-0.084999084','0.55999756','-0.07999802','0.05870056','-1.2200012','0.35499573','-0.75','3.7999878','0.05999756','-1.9299927','1.8399963','1.6199951','0.59000397','0.9799957','-0.6100006','-1.3500061','0.83000183','-0.81999207','-3.5','-0.38899994','0.89499664','0.7100067','0.07999802','3.630005','91.43005','1.1800079','2.0449982','0.48999786','-0.35998535','-2.0450134','-1.9525146','0.3400116','0.45999908','0.72999954','2.0899963','-26.964996','0.9399948','6.389984','1.1549988','1.3600159','-0.08999634','0.75499725','-3.6099854','1.2599945','-1.7700043','1.0300007','0.049987793','-0.2400055','-0.73999786','-0.80000305','-2.5399933','0.38000488','0.7900009','-0.47799683','-1.4199982','0.9599991','-0.83000183','0.9291992','-2.5099792','0.21499634','17.48999','1.9500122','-1.7599945','0.020000458','-0.3199997','-0.8290024','0.09500122','2.7599945','3.6800232','-0.19999695','-0.69999695','0.25','-0.125','2.4800034','-0.8199997','-0.9799957','1.2900085','0.20000076','-0.12999725','0.94000244','-1.8499985','-0.5249939','1.5999985','-3.7799988','1.1499939','-1.9100037','0.7009964','-0.16999817','0.6399994','-0.71499634','-0.6650009','-0.025024414','1.8499985','10.179993','2.4100037','0.13000488','-1.6100006','-0.055000305','-0.36999512','0.040000916','0.33000183','0.875','0.13999939','0.5','-0.4449997','-0.21999359','0.6800003','-0.83999634','1.0049973','1.2449989','1.1399994','-0.57499695','0.7599945','-0.54000854','1.5999908','9.350037','-0.89499664','-1.1599884','0.6300049','-0.3600006','0.05999756','6.149994','3.4899902','-3.2000122','0.5200043','-4.5','-1.8650055','0.11000061','8.140015','4.5849915','0.16000366','-0.62000275','1.1499939','-0.3999939','-1.6600037','1.2550049','0.02999878','2.9199982','-2.7549896','-0.27999878','-0.125','-0.54499817','-0.71500397','0.16999817','-45.994995','-0.41500092','2.4100037','-0.56999207','18.820007','2.269989','0.021003723','-28.015015','1.5650024','2.3099976','1.5699997','15.5','4.4299927','-5.349991','-0.38000488','-1.2599945','0.48000336','3.5599976','0.4900055','1.1399994','-0.43000793','1.1199951','3.0100098','1.0','0.94999695','-6.5599976','4.6900024','1.0550003','-0.3350067','0.17499542','0.38000488','2.1349792','0.90999603','1.1549988','2.069992','3.0250092','0.76000214','-0.31999207','-1.5','4.980011','9.459961','-0.69000244','-0.17999268','-0.9950104','-5.6900024','4.889984','0.55999756','2.3100128','0.6499939','-3.630005','1.1699982','0.52001953','-17.72998','7.8200073','-2.1999817','1.5599976','5.3589783','-1.9700012','2.3500366','0.17999268','-0.04499817','0.30499268','4.0400085','0.22999573','-4.5650024','8.085022','127.33008','8.080017','-47.20996','-2.3700104','-0.65000916','-2.0','-0.43499756','2.9599915','-2.4049988','1.8500061','-0.4600067','1.6149902','-109.32007','-0.08000183','6.394989','4.299988','-4.585022','5.985016','-2.3249817','11.349976','-13.329987','5.7800293','-1.4900208','-1.5050049','1.2850037','-0.6000061','0.1499939','-0.00999999','69.08008','nan','nan','nan','nan','nan','nan','nan','nan',]
var unit_prices = ['189.0','57.98','12.87','107.08','17.3','5.64','170.33','43.02','700.74','169.65','189.385','33.05','14.98','42.72','27.56','15.64','16.3','145.83','9.87','40.3','468.32','102.34','380.78','146.97','16.63','414.05','54.18','38.84','40.2','1.45','22.72','49.9','13.0','38.85','48.44','47.3','9.37','13.78','59.89','85.51','41.33','12.24','36.44','30.84','75.86','48.18','15.4','26.88','17.36','42.23','95.1','89.0','28.99','157.34','151.95','69.79','56.42','77.04','37.06','171.72','74.4','57.77','39.0','146.85','33.44','39.7','113.11','32.0','29.75','22.81','117.85','41.21','15.26','40.3','32.0','35.2','65.05','104.26','17.7','20.13','17.83','55.5','30.59','34.17','11.7','104.43','16.25','98.5','53.5','212.4','85.68','74.24','44.51','86.55','156.5','113.35','31.24','94.74','297.0','132.03','169.99','21.36','62.24','54.06','104.63','56.54','33.98','83.4','192.2','91.85','34.74','33.98','45.5','69.77','24.31','34.92','54.52','174.35','53.99','175.0','127.32','99.0','7.93','163.575','74.59','158.8','182.63','79.75','120.67','728.32','141.93','169.38','35.62','117.09','286.2','127.2','41.63','28.0','53.27','208.25','63.5','163.0','289.3','279.54','44.3','56.49','57.57','34.0','94.15','161.78','83.79','29.62','431.8','31.19','146.68','28.31','66.61','31.71','49.12','35.21','81.695','86.45','560.55','145.16','138.65','29.6','25.51','25.04','27.0','76.12','52.9','69.1','66.8','30.37','53.45','520.63','42.25','75.29','112.9','78.13','43.56','33.22','54.17','146.8','214.03','15.92','19.23','287.64','66.5','397.22','147.01','170.61','38.47','159.31','39.24','55.07','86.56','32.57','120.24','58.67','54.4','270.0','1267.0','69.49','141.5','129.03','27.42','58.23','142.47','505.01','65.07','16.18','193.59','26.99','114.07','84.67','105.35','44.11','32.79','59.73','192.97','26.77','27.37','68.78','52.92','84.84','43.44','221.44','270.49','73.0','59.15','75.83','112.2','362.86','251.21','77.8','61.45','44.21','73.1','56.16','120.89','73.43','241.9','123.71','188.93','129.63','222.0','249.07','106.3','145.03','205.99','86.59','139.99','37.0','104.32','54.0','50.8','105.0','88.62','78.63','723.89','75.56','324.67','151.5','144.83','105.2','73.82','108.74','370.43','35.74','246.45','460.0','73.6','86.7','182.21','32.49','228.0','680.0','238.47','83.98','94.5','615.85','386.0','552.2','192.63','44.93','58.58','137.0','270.5','97.4','303.502','125.09','367.68','169.59','50.29','274.455','133.89','197.63','25.32','273.0','69.8','125.14','68.26','246.05','135.31','49.83','147.17','196.08','103.81','89.07','72.01','419.3','65.59','563.25','330.51','82.5','57.35','47.53','100.47','35.13','144.98','420.28','89.81','213.91','103.28','82.56','107.89','91.65','67.05','132.42','61.71','87.75','78.89','64.81','141.31','87.48','340.72','142.2','132.55','100.22','56.7','153.15','139.55','94.44','385.88','110.48','285.37','311.11','136.5','233.84','47.29','190.18','82.94','58.7','196.58','175.01','143.06','89.55','97.22','116.77','214.12','109.25','63.56','129.63','80.09','249.99','160.49','249.69','646.43','126.75','155.46','122.0','136.73','76.03','237.6','250.82','429.36','107.05','389.51','244.0','51.91','792.0','301.5','330.0','72.47','109.39','209.27','307.06','100.39','185.92','158.47','185.68','127.34','57.05','167.6','78.99','74.33','1010.5','78.11','213.54','131.82','364.99','236.97','121.62','287.0','66.69','123.52','125.21','852.0','500.35','218.0','212.53','208.83','80.22','128.76','201.0','143.38','143.22','173.25','258.08','235.96','111.46','400.21','516.22','79.72','203.0','112.9','253.72','431.34','111.15','286.09','248.0','225.7','67.74','239.89','250.01','169.43','608.9','111.17','269.0','222.06','651.77','424.58','122.04','167.04','199.79','550.84','180.72','565.72','1153.22','934.79','452.86','165.94','453.3','270.41','512.82','216.54','148.78','228.66','281.15','186.18','586.43','340.29','3750.0','840.26','2678.05','224.08','175.27','794.06','162.45','322.72','410.775','183.06','203.92','524.72','2757.0','247.22','382.21','389.94','620.5','257.53','274.56','1212.98','482.26','947.75','372.65','433.35','322.74','434.88','249.33','1.0','7398.95','nan','nan','nan','nan','nan','nan','nan','nan',]
var total_sales = ['191.6171','58.59','12.9','112.77','17.3','5.963','172.17','43.05','707.94','171.42','189.535','33.275','14.99','42.97','27.69','15.79','16.4','146.33','9.97','40.37','470.59','104.42','381.28','147.61','16.73','415.56','54.49','38.9399','40.37','1.54','22.89','49.99','13.125','38.895','48.74','47.925','9.375','13.965','59.97','86.0346','42.485','12.37','36.68','32.32','75.87','48.5','15.71','28.0','17.665','44.285','96.63','90.56','29.455','157.34','154.3','70.64','56.38','80.91','37.145','174.1','74.59','58.295','41.305','148.61','33.59','40.425','115.285','32.49','29.86','22.92','120.98','41.63','15.52','40.49','33.1','35.67','65.09','108.76','17.986','20.36','18.12','56.57','30.81','34.28','11.695','104.96','16.32','99.44','54.29','213.1','86.23','76.41','45.495','86.756','160.0499','113.19','31.52','95.2','297.92','135.98','174.99','22.45','62.91','55.1','105.24','57.23','35.045','85.29','209.68','92.385','35.235','33.98','46.445','69.72','24.695','35.31','55.335','175.91','54.33','175.3058','127.15','99.0','8.5','173.94','75.175','159.1','184.52','79.78','124.528','740.77','142.66','170.55','35.81','117.7872','293.15','127.37','43.0','28.3','53.515','211.16','64.665','168.05','293.11','279.645','44.46','56.53','57.98','34.85','94.38','162.0','84.17','29.93','437.33','31.52','147.92','28.45','67.025','31.8093','49.12','35.575','82.0','86.645','563.7','146.92','139.46','29.78','25.62','25.13','27.24','76.29','53.04','70.67','66.94','30.37','54.035','522.065','42.28','76.56','113.94','78.66','44.43','33.585','54.2003','148.07','220.76','16.03','19.55','288.2','67.15','398.65','149.07','171.59','38.9','161.06','40.26','55.38','86.72','33.4','123.005','58.785','54.86','278.88','1295.97','69.71','142.36','132.355','27.505','58.23','144.82','510.725','65.335','16.3199','194.0','28.92','115.3388','85.419','105.89','44.34','33.22','60.31','195.17','26.93','27.72','69.035','53.185','85.308','43.835','228.85','279.77','73.39','59.32','77.56','114.0','365.65','255.0','78.02','61.97','44.73','74.685','56.32','120.99','75.2','243.34','123.555','199.37','130.69','223.59','249.04','107.35','145.89','207.58','87.43','142.81','37.07','104.9684','54.435','51.07','106.44','89.0','78.975','728.12','75.94','326.43','154.39','148.0','106.22','74.725','109.5569','372.9299','36.46','246.8','460.67','73.635','88.26','184.2468','32.775','232.45','759.9999','243.44','86.085','95.15','621.3394','388.11','552.86','194.25','45.845','59.57','138.94','275.375','99.57','308.1896','127.335','369.39','171.3899','51.31','274.4299','135.5233','197.94','26.61','274.7','70.03','126.01','68.315','246.83','136.95','51.02','148.165','197.0','105.49','89.28','73.265','419.3','66.21','573.58','333.48','82.76','57.66','47.5983','101.0','35.15','146.03','424.4761','90.095','217.43','104.095','82.405','108.92','91.81','67.05','134.81','62.51','88.4','80.1684','65.28','142.325','89.49','341.91','143.19','133.97','102.14','57.18','154.07','139.77','94.92','387.5667','113.71','296.6','312.4','137.12','235.01','47.62','190.44','83.085','59.2275','196.765','175.065','144.65','89.66','97.72','118.89','214.15','111.36','65.43','132.445','80.32','251.03','161.0','250.44','654.15','127.22','156.05','122.73','137.68','76.5999','244.76','254.23','429.7516','108.01','391.6','244.225','52.385','800.3','307.14','330.39','72.52','110.5724','209.82','307.6','102.45','187.305','161.9','186.07','127.47','57.45','167.83','79.28','74.575','1069.415','78.18','216.82','133.2227','382.78','239.25','122.0','287.995','68.27','125.11','127.74','869.59','503.98','220.995','214.33','211.775','80.82','130.51','201.7','144.35','143.8799','174.78','262.9175','238.14','112.93','400.615','521.98','80.56','202.855','113.72','254.595','437.32','112.1538','287.88','251.39','226.455','68.61','240.54','251.83','174.22','624.79','111.285','269.435','223.155','656.12','431.47','122.44','168.995','200.0','553.08','181.47','575.945','1155.24','946.74','454.07','167.43','455.49','271.7','515.1','220.555','149.7','229.46','285.35','186.27','588.46','345.67','3838.45','859.72','2689.0','229.86','176.82','798.9399','162.99','327.92','413.56','185.28','204.465','526.445','2793.39','249.745','387.305','394.64','621.97','262.78','275.39','1230.67','481.2','952.51','374.439','434.77','328.52','437.9','251.14','1.01','7493.825','nan','nan','nan','nan','nan','nan','nan','nan',]
var sales_change_30d = ['185.58','55.77','12.54','106.8','16.74','5.57','168.6','41.055','694.55','168.88','187.35','32.8001','14.605','42.33','27.4103','15.4246','16.12','145.11','9.65','39.44','465.03','102.11','380.545','146.42','16.57','412.53','53.59','38.42','39.85','1.41','22.35','49.55','12.6608','37.89','48.11','47.105','8.87','13.57','59.41','84.53','41.32','12.15','36.24','30.655','74.565','48.055','15.18','25.43','17.1301','42.345','93.925','88.3','28.91','155.31','151.68','67.76','55.385','77.13','36.73','171.41','73.03','57.555','38.11','146.3','33.23','39.385','112.585','30.835','28.515','22.475','114.3501','40.44','15.21','39.55','31.59','35.14','64.39','103.92','17.61','19.695','17.78','54.52','30.3','33.89','11.44','103.045','15.97','98.14','53.3','208.72','85.16','73.05','44.49','85.39','154.8201','111.52','31.139','91.47','288.78','131.0009','169.38','21.155','61.905','53.505','102.0216','56.34','33.875','82.96','189.5703','90.925','34.695','33.53','45.275','67.96','24.26','34.64','54.19','174.3','52.65','173.57','125.945','92.95','7.905','161.66','74.44','157.77','181.49','78.75','119.16','725.97','138.04','169.14','35.41','115.97','284.2','125.21','41.41','27.9344','53.0428','207.95','63.22','159.95','288.98','275.285','43.67','56.005','57.02','33.87','92.71','159.23','83.5','29.58','419.85','30.7','145.68','28.0025','66.3563','31.53','48.04','34.88','80.9','85.21','555.74','143.36','138.25','29.34','25.35','24.825','26.0101','75.22','52.315','69.145','66.18','29.87','52.71','517.2834','41.64','74.735','111.8044','77.355','43.33','32.92','53.5','145.855','213.81','15.71','19.14','279.6366','65.93','394.85','146.85','168.33','38.17','158.78','38.96','54.68','84.62','32.25','118.87','57.53','51.585','269.14','1265.01','69.0001','140.935','128.7892','27.185','57.405','139.19','488.29','63.63','15.94','192.25','26.75','112.28','84.435','101.27','43.695','32.77','59.2','191.905','26.48','26.41','68.21','51.935','81.28','42.995','221.44','270.25','71.84','58.86','74.26','108.495','361.6485','237.34','76.8','61.31','43.77','72.95','55.71','119.715','72.975','240.415','121.1437','186.1','128.685','219.29','246.41','105.98','142.99','203.5','85.96','139.465','36.9','104.31','53.5775','50.59','102.78','87.6','77.425','720.66','75.04','321.4201','151.31','145.21','104.65','72.06','107.39','366.925','35.32','244.08','457.445','72.672','85.7909','181.89','32.365','227.65','679.47','238.825','83.42','94.0801','612.51','381.5606','541.49','191.63','44.94','58.34','136.68','259.28','97.4','302.46','125.055','366.915','168.65','50.255','269.75','132.5','191.95','25.1615','272.39','69.17','122.03','67.32','242.405','135.08','49.39','145.8575','195.0','103.39','88.11','71.9','413.36','65.29','562.0','329.955','80.52','56.1','46.985','99.75','34.78','144.85','417.14','89.04','213.91','102.205','81.64','106.65','90.47','65.2','132.232','61.62','87.0251','78.705','63.79','141.2','87.2','337.08','141.53','130.17','100.005','56.67','151.77','136.55','92.88','384.27','110.48','283.67','307.53','136.02','230.492','47.125','188.56','81.95','58.565','194.5','173.09','141.79','88.59','96.24','116.4768','211.0304','109.4','63.52','129.36','79.44','248.395','158.19','245.81','643.17','125.21','153.07','121.1','136.415','75.54','237.065','250.99','425.73','105.75','385.36','241.8035','51.75','790.84','301.1406','326.15','71.52','109.034','206.49','302.11','100.24','184.56','157.925','181.74','125.16','56.6','165.55','77.96','73.59','1009.29','76.79','212.12','130.74','360.63','235.0','120.55','266.05','66.36','122.5','124.26','846.1401','499.99','210.0','211.32','207.07','79.73','127.825','199.8221','142.69','141.98','172.87','258.02','235.39','111.345','393.4','513.3','79.12','201.465','112.5313','251.315','428.605','110.165','284.015','247.53','222.03','67.62','237.535','248.37','169.235','608.165','109.71','267.12','220.75','644.46','423.01','120.88','166.06','198.17','540.38','179.07','562.42','1108.9','930.04','449.81','164.591','449.22','267.92','509.015','216.44','146.92','225.85','281.105','183.58','582.195','339.5','3727.31','840.26','2616.48','223.75','173.625','787.5','160.47','320.7','407.14','182.41','200.42','518.66','2707.5','245.68','379.585','388.105','615.96','256.84','270.165','1210.8','468.14','941.78','368.46','428.84','323.84','434.51','246.71','0.825','7407.57','nan','nan','nan','nan','nan','nan','nan','nan',]
var curr_price = ['189.53','56.095','12.8025','110.345','16.84','5.77','169.27','41.265','696.435','169.6975','188.155','33.131','14.955','42.495','27.545','15.68','16.225','145.82','9.82','39.88','469.675','103.86','381.02','147.09','16.62','413.68','54.325','38.64','40.055','1.5','22.69','49.92','13.025','38.115','48.74','47.715','9.16','13.85','59.785','84.92','42.385','12.31','36.455','32.305','75.045','48.325','15.37','25.83','17.5','42.825','96.615','88.97','29.295','156.28','153.75','67.855','56.255','80.68','37.04','173.87','73.79','58.09','40.465','148.2','33.365','40.33','113.94','31.41','28.795','22.52','116.965','41.605','15.465','40.365','31.78','35.465','65.005','106.0','17.87','19.98','17.95','54.78','30.46','34.055','11.53','103.58','16.21','98.36','53.615','209.1796','85.585','73.335','45.37','86.23','159.26','112.155','31.485','92.575','294.815','134.0','173.87','22.06','62.4','54.985','102.305','56.595','34.859','84.355','202.48','91.13','34.9922','33.745','46.355','68.41','24.51','35.005','55.17','174.74','53.315','174.61','126.485','93.63','8.445','171.5','74.73','158.46','184.2202','79.165','123.21','734.95','140.635','169.285','35.805','116.62','292.14','126.98','42.7856','28.245','53.105','210.955','64.035','161.7','291.9','275.775','44.24','56.4575','57.085','34.735','93.2','160.84','84.13','29.61','436.44','31.35','146.84','28.09','66.96','31.715','48.62','35.535','81.31','85.88','558.335','146.35','139.035','29.425','25.62','25.035','26.335','75.9','52.67','69.52','66.74','30.085','54.005','520.03','42.005','76.54','112.91','78.295','44.23','33.365','53.855','147.98','219.7','15.9','19.53','282.14','67.13','397.22','147.13','169.5','38.865','160.19','39.835','55.14','86.6','33.13','121.03','58.135','52.14','275.665','1274.24','69.25','141.7925','131.54','27.4','57.985','143.5','494.65','64.61','16.285','193.43','27.02','114.19','85.25','102.74','43.765','33.035','60.285','194.11','26.79','26.615','68.95','52.415','81.69','43.165','227.91','278.54','72.38','59.18','75.17','108.93','363.45','252.06','77.41','61.47','44.445','74.46','56.24','120.155','74.79','241.82','122.25','196.135','130.56','220.43','248.66','107.35','144.72','203.98','87.05','140.92','36.945','104.82','53.86','50.9087','104.0','88.015','78.08','723.58','75.54','321.66','153.29','147.09','105.65','74.64','108.52','367.22','36.43','245.82','458.41','73.461','87.655','182.88','32.64','231.39','736.84','240.66','85.985','94.96','615.49','384.615','550.3575','193.96','45.55','59.22','138.84','265.025','98.45','307.12','126.725','368.01','169.5','50.655','269.82','135.23','194.26','26.42','272.9','69.81','124.44','67.89','244.35','135.67','50.99','147.692','195.67','104.67','88.64','73.2292','414.32','65.835','571.77','332.5','80.58','57.36','47.46','99.921','35.115','146.01','422.76','89.65','216.3','103.26','82.205','108.76','90.95','66.26','134.08','62.14','87.58','79.87','64.24','142.255','88.83','338.94','143.14','130.59','100.891','56.74','153.33','138.655','94.025','385.925','112.7','294.91','312.27','136.63','231.84','47.515','189.61','83.01','59.15','196.605','174.7','143.94','89.245','97.41','117.9','213.38','109.965','65.015','131.61','79.765','251.03','159.93','249.54','652.52','126.525','154.38','122.73','136.65','76.42','243.75','254.04','426.9','107.55','386.875','242.555','52.02','798.53','306.465','328.09','72.04','110.2','209.16','305.62','102.095','186.24','161.06','183.835','127.33','57.005','166.185','78.405','74.27','1021.025','77.695','216.75','131.05','380.92','238.79','121.971','266.485','67.925','124.78','127.37','864.04','502.22','220.52','213.37','207.64','80.32','130.5','200.77','143.55','143.15','174.54','261.44','237.2','112.88','398.29','518.73','80.535','202.665','113.255','254.47','434.585','111.95','286.845','250.18','225.445','68.58','240.22','249.16','174.16','618.36','110.92','268.91','222.715','647.04','426.84','122.29','168.35','198.9','545.06','181.38','572.83','1129.28','946.31','451.7','166.87','455.309','269.82','515.09','218.76','148.965','229.325','285.25','184.69','586.065','345.015','3836.25','854.81','2619.78','224.04','174.7','792.7','162.015','326.5','410.595','185.14','202.61','526.095','2733.22','247.03','387.245','394.31','617.035','261.795','272.415','1224.58','469.73','950.78','373.15','430.585','326.445','435.28','251.04','1.0','7489.79','nan','nan','nan','nan','nan','nan','nan','nan',]
var store_id = ['80630676.0','65418358.0','62691280.0','57044797.0','55934918.0','50815955.0','40637491.0','39347021.0','38517354.0','35656256.0','32317979.0','28608570.0','25901877.0','23283388.0','23223854.0','21390287.0','20635097.0','18081769.0','17019660.0','16343273.0','16286790.0','16176239.0','15702662.0','15193796.0','14647734.0','14284008.0','13480518.0','13449951.0','13079244.0','13045826.0','12326757.0','12049946.0','11660012.0','11496908.0','10886058.0','10869335.0','10665048.0','10590666.0','10245295.0','9974794.0','9717382.0','9676087.0','9290956.0','9255396.0','9254140.0','8904222.0','8896423.0','8703712.0','8647652.0','8451097.0','8283073.0','7957121.0','7616922.0','7438249.0','7351930.0','7248430.0','7013690.0','6965382.0','6943574.0','6916589.0','6700641.0','6656493.0','6641264.0','6622844.0','6591086.0','6534046.0','6501075.0','6475795.0','6371366.0','6279442.0','6243886.0','6194822.0','6177576.0','6135194.0','6058203.0','6048903.0','6019652.0','6009592.0','5967458.0','5858132.0','5844166.0','5670913.0','5660749.0','5655507.0','5547807.0','5382987.0','5357830.0','5233237.0','5225190.0','5217323.0','5171748.0','5144601.0','5066050.0','4909629.0','4845747.0','4820747.0','4793819.0','4725356.0','4707283.0','4694499.0','4636435.0','4571410.0','4555261.0','4448075.0','4444181.0','4416441.0','4400475.0','4389335.0','4386099.0','4384505.0','4381458.0','4366475.0','4255331.0','4231436.0','4207128.0','4200419.0','4197295.0','4181903.0','4052879.0','4021612.0','4016031.0','3995089.0','3994166.0','3992239.0','3917107.0','3839153.0','3837220.0','3830478.0','3821556.0','3800488.0','3787367.0','3753408.0','3681840.0','3680141.0','3653554.0','3583963.0','3565533.0','3565452.0','3472700.0','3434632.0','3426112.0','3391132.0','3385921.0','3372735.0','3344852.0','3341483.0','3340137.0','3313569.0','3277934.0','3274049.0','3263699.0','3086433.0','3078922.0','3059100.0','2999980.0','2964343.0','2960859.0','2904540.0','2899842.0','2898222.0','2865928.0','2834004.0','2819082.0','2808914.0','2767937.0','2741138.0','2736476.0','2727984.0','2698161.0','2695048.0','2685109.0','2683844.0','2652819.0','2645820.0','2641319.0','2638533.0','2630078.0','2614419.0','2600114.0','2576051.0','2576044.0','2565006.0','2560223.0','2555035.0','2533880.0','2531565.0','2496868.0','2481416.0','2457104.0','2456378.0','2418983.0','2382405.0','2382155.0','2282980.0','2276098.0','2260155.0','2243002.0','2237493.0','2224380.0','2205954.0','2160651.0','2159627.0','2116625.0','2104440.0','2098264.0','2097769.0','2084381.0','2082507.0','2038260.0','2033476.0','2009038.0','2008813.0','2001335.0','1952543.0','1944395.0','1941497.0','1902368.0','1862464.0','1853217.0','1850000.0','1818514.0','1800639.0','1778414.0','1776598.0','1770351.0','1767164.0','1766880.0','1762347.0','1745831.0','1724553.0','1719081.0','1695612.0','1687586.0','1670919.0','1656564.0','1650410.0','1642613.0','1624361.0','1613012.0','1607117.0','1599725.0','1594306.0','1578956.0','1569657.0','1553110.0','1553044.0','1544426.0','1530525.0','1526403.0','1518994.0','1513766.0','1513623.0','1511472.0','1511427.0','1508323.0','1494115.0','1490923.0','1470598.0','1459254.0','1455529.0','1454406.0','1445288.0','1438822.0','1438294.0','1431364.0','1411084.0','1387747.0','1384723.0','1374711.0','1373963.0','1373855.0','1369374.0','1354056.0','1353315.0','1352268.0','1351414.0','1351191.0','1347375.0','1340851.0','1338004.0','1327333.0','1316786.0','1314784.0','1304049.0','1303569.0','1299014.0','1295162.0','1291806.0','1288846.0','1288720.0','1279423.0','1276119.0','1273930.0','1268282.0','1267716.0','1264278.0','1263993.0','1263213.0','1253564.0','1251837.0','1238118.0','1229780.0','1229613.0','1228010.0','1220700.0','1211448.0','1196933.0','1195479.0','1188333.0','1182404.0','1178682.0','1175009.0','1171523.0','1158456.0','1129135.0','1127411.0','1115447.0','1097632.0','1097403.0','1092060.0','1085947.0','1082684.0','1081413.0','1063989.0','1063730.0','1036761.0','1034955.0','1028879.0','1025117.0','1023810.0','1015030.0','1012581.0','1008122.0','1005498.0','1004353.0','1000025.0','997465.0','996763.0','984310.0','982653.0','952867.0','948880.0','948179.0','946203.0','934853.0','930041.0','922570.0','909490.0','909213.0','901111.0','900499.0','888907.0','882362.0','874792.0','872305.0','871877.0','871711.0','867985.0','854323.0','848473.0','841876.0','841295.0','838351.0','824147.0','823105.0','817152.0','812470.0','811932.0','811901.0','802510.0','802424.0','800378.0','792979.0','787422.0','782356.0','774109.0','769361.0','766509.0','765415.0','762220.0','759336.0','755740.0','754393.0','753923.0','753074.0','752685.0','751373.0','751170.0','748357.0','744869.0','739077.0','737758.0','735254.0','731652.0','726255.0','723228.0','717830.0','716492.0','708586.0','696608.0','696378.0','694361.0','691688.0','675194.0','668427.0','665355.0','654287.0','647501.0','646760.0','641234.0','629327.0','619632.0','617889.0','616596.0','609652.0','607133.0','601485.0','593762.0','593755.0','586688.0','567161.0','566614.0','559869.0','546147.0','545148.0','543861.0','541526.0','537408.0','535411.0','534521.0','524865.0','524516.0','521105.0','518065.0','512522.0','505129.0','505006.0','486332.0','477182.0','463968.0','460768.0','444712.0','443013.0','441815.0','432610.0','424155.0','409073.0','395777.0','389926.0','382387.0','377992.0','377094.0','374115.0','372631.0','365454.0','355559.0','355451.0','347835.0','342988.0','330136.0','322660.0','316440.0','316122.0','309787.0','305046.0','303312.0','301351.0','301093.0','298831.0','295199.0','282577.0','282031.0','278005.0','233802.0','226103.0','209337.0','205511.0','195412.0','193979.0','192024.0','187869.0','184949.0','182467.0','179933.0','157650.0','131049.0','119813.0','106809.0','89755.0','67695.0','38807.0','16420.0','nan','nan','nan','nan','nan','nan','nan','nan',]
  var percent_change = []
  var xmlhttp = new XMLHttpRequest()




  


// -------------------------------------------- //


init()
function init () {
  container = document.createElement('div')
  document.body.appendChild(container)


function calc_percent ()

{
  for (var i = 0; i < 2000; i++) { //convert change dollar values into percent
      var quote_change = change[i];
      var current_price =curr_price[i];
      quote_change = (quote_change/(current_price-quote_change))*100
      quote_change = quote_change.toFixed(2);
      percent_change.push([quote_change]);
    }
}

calc_percent();

function assignLinks () //this assigns k values to the ranked link ids, so that the highest values occur at the highest chart points for each concentric ring.

  {
  var interval = 50;

  for (var i = 0; i < 12; i++) { //link ids for the innermost petal ring
    k = (i * interval )+ 25;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = 0; j < 12; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }

  var link_order_length = link_order.length;
  var stop= link_order_length + 14

  for (var i = 0; i < 14; i++) {  //link ids for the middle petal ring
    k = (i * interval )+ 25;
    k = k + 600;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = link_order_length; j < stop; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }

  var link_order_length = link_order.length;
  var stop= link_order_length + 16

  for (var i = 0; i < 16; i++) {  //link ids for the outer petal ring
    k = (i * interval )+ 25;
     k = k + 1300;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = link_order_length; j < stop; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }


}

assignLinks();


//console.log(link_order)
//console.log(symbols)



//Petal Constructor - draws outline of petal
function drawPetal (
    x,
    y,
    z,
    x0,
    y0,
    z0,
    x1,
    y1,
    z1,
    petalheight,
    ctrlpt,
    color_code,
  ) {
    var curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0 + petalheight, z0)
    )

    var points = curve.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var curve2 = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x0, y0 + petalheight, z0),
      new THREE.Vector3(x1, ctrlpt, z1),
      new THREE.Vector3(x1, y1, z1)
    )

    var points = curve2.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })

    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)
  }


  //Chart Position Arc - returns points for top of chart lines
  function chartTop (
    x,
    y,
    z,
    x0,
    y0,
    z0,
    x1,
    y1,
    z1,
    petalheight,
    ctrlpt,
    color_code
  ) {
    var curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0 + petalheight, z0)
    )

    var points1 = curve.getSpacedPoints(25)
    var geometry = new THREE.BufferGeometry().setFromPoints(points1)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var curve2 = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x0, y0 + petalheight, z0),
      new THREE.Vector3(x1, ctrlpt, z1),
      new THREE.Vector3(x1, y1, z1)
    )

    var points2 = curve2.getSpacedPoints(25)
    var geometry = new THREE.BufferGeometry().setFromPoints(points2)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var points = points1.concat(points2)
    return points
  }


  //Chart Position - draws chart lines within petal arc
  function chartPosition (x, y, z, x0, y0, z0, petalheight, ctrlpt, color_code) {
    var cPcurve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var points = cPcurve.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)
  }


//Invisible Spaghetti - add TubeGeometry objects that sheath chart lines representing active geometric links.
function invisibleSpaghetti (k, x, y, z, x0, y0, z0, petalheight, ctrlpt) {
    var link_curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var geometry = new THREE.TubeGeometry(link_curve, 8, 0.002, 4, false)  //previous values: 64, 0.004, 8,
    var material = new THREE.MeshBasicMaterial()
    var object = new THREE.Mesh(geometry, material)
    material.transparent = true
    material.opacity = 0
    object.label = k
    parentTransform.add(object)
  }

//Visible Spaghetti - visible TubeGeometry objects represent highlighted links.
function visibleSpaghetti (k, x, y, z, x0, y0, z0, petalheight, ctrlpt, color_code) {
    var link_curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var geometry = new THREE.TubeGeometry(link_curve, 16, 0.004, 4, false)  //previous values: 32, 0.004, 4,
    var material = new THREE.MeshBasicMaterial({ color: color_code })
    var object = new THREE.Mesh(geometry, material)
    material.transparent = true
    material.opacity = .7
    object.label = k
    parentTransform.add(object)
  }

//Draw Petals - draws ring of lotus petals
function drawPetalRing (segmentCount, radius, depth, color_code, chartLines, divisor){
  var geometry = new THREE.Geometry(),
  material = new THREE.LineBasicMaterial({ color: color_code })

  for (var i = 0; i <= segmentCount; i++) {
    var theta = (i / segmentCount) * Math.PI * 2
    var iota = ((i + 0.5) / segmentCount) * Math.PI * 2
    var kappa = ((i + 1) / segmentCount) * Math.PI * 2
    drawPetal(
      Math.cos(theta) * radius,
      0,
      Math.sin(theta) * radius,
      Math.cos(iota) * (radius - depth),
      0,
      Math.sin(iota) * (radius - depth),
      Math.cos(kappa) * radius,
      0,
      Math.sin(kappa) * radius,
      0.5,
      0.45,
      color_code
    )
  }
  group.add(new THREE.Line(geometry, material))


  //Draws Chart Lines 
  var geometry = new THREE.Geometry(),
    material = new THREE.LineBasicMaterial({ color: color_code })

  for (var i = 0; i < chartLines; i++) {
    var k = 0
    var theta = (i / chartLines) * Math.PI * 2
    var iota = ((i + 0.5) / chartLines) * Math.PI * 2
    var kappa = ((i + 1) / chartLines) * Math.PI * 2
    var iota0 = ((i + divisor / 2) / chartLines) * Math.PI * 2
    var kappa0 = ((i + divisor) / chartLines) * Math.PI * 2
    var modulus = i % divisor

    var base_x = Math.cos(theta) * radius
    var base_y = 0
    var base_z = Math.sin(theta) * radius
    var petalheight = 0.5
    var ctrlpt = 0 //ctrl pt for chart lines (within petal)
    var arcpt = 0.45 //ctrl pt for petal arc (outline)

    if (modulus == 0) {

//this resets chart line variables for each new petal drawn

      var chartPoint = chartTop(
        Math.cos(theta) * radius,
        0,
        Math.sin(theta) * radius,
        Math.cos(iota0) * (radius - depth),
        0,
        Math.sin(iota0) * (radius - depth),
        Math.cos(kappa0) * radius,
        base_y,
        Math.sin(kappa0) * radius,
        petalheight,
        arcpt,
        0x00769d
      )

      for (var j = 1; j <= divisor; j++) {
        k = i + j
        k=k-1
        var theta0 = (k / chartLines) * Math.PI * 2
        var base_xk = Math.cos(theta0) * radius
        var base_yk = 0
        var base_zk = Math.sin(theta0) * radius
        if (chartLines==600) {  //this ensures that each k value is unique within the lotus flower
          k=k;
          }
        if (chartLines==700) {
          k=k+600;
          }
        if (chartLines==800) {
          k=k+1300;
          }
        

        chartPosition(
          chartPoint[j].x,
          chartPoint[j].y,
          chartPoint[j].z,
          base_xk,
          base_yk,
          base_zk,
          petalheight,
          ctrlpt,
          color_code
        )

        k_values.push([    //k values each define a unique curve in 3D space. They are not associated with a specific petal ring.
          k,
          chartPoint[j].x,
          chartPoint[j].y,
          chartPoint[j].z,
          base_xk,
          base_yk,
          base_zk,
          petalheight,
          ctrlpt,
        ])
      }
    }


    geometry.vertices.push(
      new THREE.Vector3(Math.cos(theta) * radius, 0, Math.sin(theta) * radius)
    )
  }

  parentTransform = new THREE.Object3D()
  group.add(parentTransform)
  group.add(new THREE.Line(geometry, material));

}


  // -------------------------------- // 



drawPetalRing (12, .65, .1, 0x00769d, 600, 50) //center petals

drawPetalRing (14, .85, .1, 0x0289b6, 700, 50)  //middle petals

drawPetalRing (16, 1, 0,  0x0099cc, 800, 50)  //outer petals

getActiveLinks();
addLinks();
render();

document.getElementById('nowplaying').innerHTML =
      '<br><br><br><br><br>'

function getActiveLinks()  //sorts for a given set of values from the data obtained above
{

    var f = percent_change.entries();

    for (x of f) {
      var quote =x;
      var change_value = quote[1];
      var change_index = quote[0];

      if (change_value > uptrend) {
        
        active_links.push(change_index);
        //console.log(change_value)
      }

      else if (change_value < downtrend) {
        change_index = quote[0]
        active_links2.push(change_index);
      }
    }
}

console.log (active_links.length)
console.log (active_links2.length)

function addLinks() {  //adds links for selected values

  link_order_length = link_order.length
//  console.log(link_order_length)

for (i = 0; i < link_order_length; i++) {

    if (active_links.includes(i)) {

      var k = link_order[i];
      var color_code = 0x00A86B; 

      visibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )
    }

    if (active_links2.includes(i)) {

      var k = link_order[i];
      var color_code = 0xfa8072;

      visibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )
    }

    else

    var k = link_order[i];       

        invisibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )

  }
}


  // -- quote details code

  function showPointer () {
    document.body.style.cursor = 'pointer'
  }

  function nowPlaying (k) {
      l = link_order.indexOf(k)

      volume = store_id[l]
      volume = (new Intl.NumberFormat().format(volume));


      if (symbols[l] == undefined)
      {
        document.getElementById('nowplaying').innerHTML =''
      }

      else

         document.getElementById('nowplaying').innerHTML =
      '<br><br><b>Symbol</b>: ' + symbols[l] + '&nbsp; &nbsp;'  
      + '<br><b>Current Price:</b> ' + '$' + curr_price[l] + '&nbsp; &nbsp;'
      + '<br><b>Change Since Previous Close:</b> ' + percent_change[l] + '%'
      + '<br><b>Volume:</b> ' + '$' + volume + '&nbsp; &nbsp;'
      + '<b>Open:</b> ' + '$' + unit_prices[l] + '&nbsp; &nbsp;' +  
      '<br><b>High:</b> ' + '$' + total_sales[l] + '&nbsp; &nbsp;' + '<b>Low:</b>' + '$' + '&nbsp; &nbsp;' + sales_change_30d[l] 
      /* + '<span style="color:#0099cc;">' + quote_change + '%</span>'
*/

            }

  function datestamp (date,time) {
  document.getElementById('datestamp').innerHTML =
      '<span style = "color:#00A86B; font-weight:bold; font-size: 16px;">Trending Up</span>&nbsp; '+ active_links.length + ' links<br>' +
      '<span style = "color:#fa8072; font-weight:bold; font-size: 16px;">Trending Down</span>&nbsp; '+ active_links2.length + ' links<br>' +
      time + " &nbsp;" + date
      }


  datestamp(date,time); 


  // --- raycaster code

  raycaster = new THREE.Raycaster()

  document.addEventListener('mousemove', onDocumentMouseMove, false)
  window.addEventListener('click', onMouseClick, false)
  window.addEventListener('resize', onWindowResize, false)
  
  function onDocumentMouseMove (event) {
    event.preventDefault()
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1
    raycaster.setFromCamera(mouse, camera)

    var intersects = raycaster.intersectObjects(parentTransform.children, true)
    
    if (intersects.length > 0) {
      showPointer()
    }
    else {
      document.body.style.cursor = 'default'
      document.getElementById('nowplaying').innerHTML =
      '<br><br>'
    }

    for (var i = 0; i < intersects.length; i++) {
      var intersection = intersects[i],
      obj = intersection.object
      k = obj.label
      l = link_order.indexOf(k)   //connects the k value -- position on lotus petal graph -- to ID for link value
      nowPlaying(k)

      /*console.log(symbols[l])
      console.log(current_price[l])
      console.log(unit_prices[l])
      console.log(sales_change_30d[l])
      console.log(active_links)
      console.log(active_links2)*/
    }
  }


  function onMouseClick (event) {
    //event.preventDefault()
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1
    raycaster.setFromCamera(mouse, camera)
    var intersects = raycaster.intersectObjects(parentTransform.children, true)
    for (var i = 0; i < intersects.length; i++) {
      var intersection = intersects[i],
      obj = intersection.object
      k = obj.label
      l = link_order.indexOf(k)   //connects the k value -- position on lotus petal graph -- to ID for link value
      var URL = "https://finance.yahoo.com/quote/" + symbols[l]
      //console.log(symbols[l])
      //console.log(quote_change_1h[l])
      window.open(URL, '_blank')
    }
  }

  function onWindowResize () {
    camera.aspect = window.innerWidth / window.innerHeight
    camera.updateProjectionMatrix()
    renderer.setSize(window.innerWidth, window.innerHeight)
  }

  //animate and render

  camera.position.z = 5

  function animate () {
    requestAnimationFrame(animate)
    group.rotation.x += 0.0
    group.rotation.y += 0.0
  }
  animate()
  render()

  function render () {
    dot += 0
    renderer.render(scene, camera)
    renderer.setClearColor(0xffffff, 1)
  }
}

//  ---- reference code ----- //  


//  ---- reference code ----- //  