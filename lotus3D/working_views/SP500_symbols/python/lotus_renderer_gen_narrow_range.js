//Copyright 2022 by Lotus.fm LLC, 2000_view

var camera, scene, raycaster, renderer, parentTransform
var mouse = new THREE.Vector2()
var r = 100,
  dot = 0

  var scene = new THREE.Scene()

  var camera = new THREE.PerspectiveCamera(  
    7.7, // This variable controls size -- the lower the value the larger the rendering. Original value was 27.
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  )

  var container = document.getElementById('container')

  containerWidth = window.innerWidth
  containerHeight = window.innerHeight

  renderer = new THREE.WebGLRenderer({ antialias: true })
  renderer.setPixelRatio(window.devicePixelRatio)
  renderer.setSize(window.innerWidth, window.innerHeight)
  document.body.appendChild(renderer.domElement)

  var controls = new THREE.OrbitControls(camera, renderer.domElement)
  controls.minDistance = 0
  controls.maxDistance = 100
  controls.maxPolarAngle = Math.PI / 2
  controls.addEventListener( 'change', () => renderer.render( scene, camera ) );


  var light = new THREE.PointLight(0xffffff)
  light.position.set(-100, 200, 100)
  scene.add(light)

  var group
  group = new THREE.Group()
  group.position.set( 0, -.08, -5);
  group.rotation.set(1,0,0);
  scene.add(group)

  var link_order_length = 0


 


  var link_order = [] // list of all link values in the module, with k values assigned to each index position
  var k_values = [] // list of all k values generated for corresponding module chart lines
  var active_links = [] //index values of active links
  var active_links2 = [] //index values of active links
var time = '16:00 EST'
var date = '2024/02/06'
var symbols = ['TSLA','F','AMD','NVDA','PFE','DISH','AAPL','AMZN','AAL','INTC','PCG','GOOGL','BAC','KEY','T','CCL','BMY','META','GOOG','CSCO','CMCSA','MSFT','LUMN','VZ','HBAN','PYPL','GM','DIS','ABMD','C','AMCR','WBD','WFC','XOM','MU','SLB','KO','FCX','CTLT','KDP','BKR','FTNT','KMI','NCLH','CVS','NKE','SBUX','ON','VFC','WBA','NEE','MO','RF','NEM','OXY','HPE','PARA','JNJ','CARR','CSX','CFG','USB','JCI','LLY','GILD','DD','UPS','BA','DAL','HPQ','IR','MS','QCOM','XRAY','TFC','LUV','ABBV','EW','MNST','MRO','DVN','KR','JPM','VTRS','UAL','CTSH','CL','MCHP','CVX','MDLZ','SCHW','KHC','MRK','ENPH','EBAY','MCD','PG','EXC','ADM','AMGN','PPL','FMC','EL','VICI','BSX','FITB','O','HAL','AES','IVZ','PEP','PM','PEAK','LVS','WDC','DOW','APD','GE','ABT','WMT','COP','CAG','WMB','RTX','APA','MDT','ORCL','CTVA','AMAT','KIM','NI','MOS','FOXA','VRTX','CNC','V','TSN','TPR','CTRA','IPG','TJX','BALL','CRM','ZION','NDAQ','TMUS','TXN','D','GIS','HST','CHTR','ACN','VLO','MTCH','NXPI','PNC','BK','APTV','MGM','PLD','NWL','HON','MET','PEG','ADI','JNPR','MMM','BAX','FAST','ADBE','UDR','EOG','IBM','SYF','PSX','SO','AXP','K','XYL','WY','AEP','CPRT','CNP','GLW','EQT','CPB','LIN','MRNA','ALB','SPG','INVH','FIS','ES','CCI','XEL','IP','AIG','RCL','HRL','TGT','CZR','CAT','OGN','NFLX','YUM','WELL','APH','ICE','EMR','CDAY','CMA','UNH','MPC','LYV','FDX','CEG','DXC','BWA','FE','AFL','AVGO','STX','SEDG','SYY','WYNN','ANET','OKE','BRK-B','ZTS','DHR','EIX','HOLX','BEN','ALK','NWSA','UNP','DHI','SWKS','HUM','CMS','TAP','PAYX','DUK','FTV','AEE','EVRG','MA','LOW','NRG','CAH','SRE','PCAR','HWM','ETSY','WRK','PHM','VNO','HES','PRU','DXCM','ETR','WM','CMI','INCY','LEN','HD','CHD','FANG','ETN','VTR','DGX','HLT','COST','LYB','EXPE','TEL','ZBH','BBWI','ROK','DFS','ILMN','OMC','KMB','AMT','DE','CI','A','PXD','DLR','ISRG','CF','ADP','WEC','BDX','HIG','MKC','HSY','COF','BBY','AME','PGR','KMX','EQR','CHRW','LW','ROST','STT','ED','ARE','OTIS','SJM','EA','GS','MAR','TRV','HAS','SEE','DG','QRVO','LNT','ALGN','SHW','MAS','MMC','EMN','SWK','BRO','ECL','BXP','CB','CSGP','TER','LKQ','SNPS','PPG','AWK','PAYC','TMO','SYK','CME','CBRE','CPT','RMD','LNC','BIIB','GPN','ITW','CLX','DOV','NUE','HCA','J','IFF','DLTR','PNR','AKAM','AVB','ROL','SBAC','IT','BF-B','ATO','NTAP','CDNS','NOW','STZ','LMT','MTB','REG','LRCX','LHX','IQV','KLAC','DTE','TROW','PWR','RSG','WTW','DRI','TSCO','EXR','MAA','ALL','AJG','NSC','SPGI','TECH','TT','NTRS','TTWO','EFX','IRM','INTU','WAT','RL','HSIC','PFG','AOS','GPC','WAB','FOX','L','ADSK','MKTX','GD','ODFL','TXT','MCK','DVA','WRB','AON','VMC','TRMB','EXPD','CDW','CINF','AAP','GNRC','ELV','JKHY','WHR','FLT','WST','RJF','CE','JBHT','BLK','NWS','PKG','PTC','PH','ULTA','MSI','RHI','PSA','STE','NOC','KEYS','LDOS','MHK','IDXX','BR','PNW','DPZ','GRMN','AVY','MPWR','AIZ','MOH','CBOE','ANSS','VRSK','VRSN','FFIV','URI','EQIX','MSCI','REGN','LH','ZBRA','ESS','IEX','CMG','MLM','MCO','GL','FRT','AMP','CTAS','ROP','HII','ALLE','CRL','SBNY','EPAM','TDG','ORLY','UHS','GWW','BKNG','COO','TFX','SNA','FDS','BIO','POOL','TDY','NDSN','AZO','MTD','TYL','NVR','TWTR','SIVB','RE','PKI','NLSN','NLOK','FRC','FISV',]
var price = ['185.1','12.07','167.88','682.23','27.5','5.77','189.3','169.15','14.9','42.74','16.24','144.1','33.04','13.9','17.61','15.97','49.26','454.72','145.41','49.98','44.42','405.49','1.35','41.1','12.37','63.71','38.03','99.29','381.02','54.35','9.18','10.07','48.29','102.25','84.6','48.01','59.94','40.17','58.46','31.11','29.39','67.48','16.69','17.44','73.76','102.61','95.67','76.32','16.95','23.11','56.23','40.6','17.86','33.66','57.57','15.28','13.99','158.06','54.31','37.02','31.54','40.1','53.26','705.03','77.72','65.74','145.92','208.58','40.18','28.29','83.24','86.1','144.1','34.16','36.25','31.03','173.29','88.25','56.34','22.53','41.08','44.99','175.1','11.89','41.23','78.73','83.74','83.25','152.35','75.25','61.89','37.21','126.88','100.51','42.66','284.65','158.96','33.91','53.37','316.07','25.69','53.45','146.21','29.83','64.79','33.47','53.75','34.82','16.5','15.88','171.42','91.66','18.08','52.17','58.45','54.04','218.05','137.58','114.0','169.81','111.52','28.62','34.3','92.28','30.52','87.74','115.3','52.09','168.7','20.25','25.08','30.35','31.62','416.13','74.92','276.76','55.39','41.0','24.32','32.99','97.1','57.25','285.83','38.9','56.32','161.0','158.37','45.09','64.83','19.47','290.28','364.7','137.83','36.04','223.0','149.29','55.06','84.19','44.69','130.5','8.06','193.64','65.96','58.98','189.71','36.99','93.76','39.71','69.48','607.14','35.56','111.88','183.41','38.79','145.91','67.4','205.65','54.43','119.56','32.81','77.23','50.48','27.61','32.04','34.23','44.36','415.56','100.03','113.02','143.39','32.72','61.62','53.74','107.66','58.44','33.14','68.77','120.57','30.09','144.43','43.38','322.72','16.95','555.88','127.27','86.53','102.77','126.33','94.26','69.52','49.25','510.67','166.64','88.84','241.32','131.01','21.35','34.07','35.81','76.92','1222.65','86.2','67.38','80.41','100.06','264.89','67.94','393.74','196.14','248.2','65.13','74.17','26.63','35.99','24.68','249.87','143.03','103.05','366.35','56.47','61.29','122.19','95.06','81.55','68.38','49.66','460.5','218.12','53.52','104.07','69.76','104.23','58.43','74.85','38.37','102.57','25.31','146.05','103.39','124.92','99.45','189.21','251.54','59.63','150.94','356.25','100.16','151.99','271.12','45.1','126.26','194.62','710.79','94.47','153.7','141.55','127.6','43.14','259.98','105.66','144.89','89.0','121.33','191.67','388.9','327.58','135.86','228.05','144.26','389.69','76.14','250.81','78.34','238.68','89.7','67.05','194.78','134.35','74.84','166.08','180.27','71.83','59.18','74.52','101.06','142.16','72.45','89.77','117.63','91.94','132.21','135.26','384.99','244.76','213.01','49.24','34.72','134.31','108.61','47.76','288.44','307.88','68.78','194.5','82.61','89.34','78.41','199.95','63.31','247.67','83.88','97.75','47.12','542.43','139.89','122.52','197.66','560.28','339.77','202.78','84.19','95.32','190.72','26.82','245.55','135.86','255.69','154.77','160.82','181.35','306.82','139.91','80.77','137.765','73.58','124.48','172.75','44.01','218.6','461.7','56.91','111.81','87.6','292.8','777.45','248.65','426.95','132.27','62.21','834.62','207.71','215.41','601.62','104.21','108.98','206.11','173.68','268.45','165.92','233.79','142.73','125.58','157.35','234.05','251.86','453.29','67.37','270.23','78.2','166.67','243.28','68.96','635.3','330.38','147.34','76.09','78.4','78.22','141.32','134.74','29.34','72.81','253.98','221.26','267.69','425.55','86.09','506.87','112.08','80.49','300.83','231.58','51.69','126.01','230.5','112.1','66.37','117.35','493.83','163.91','109.23','286.99','398.27','111.35','147.87','211.4','787.98','25.7','163.03','177.11','511.55','502.0','325.38','80.1','278.65','225.92','448.17','155.97','112.16','106.81','567.0','198.85','68.08','421.58','121.81','198.44','632.98','168.89','357.12','180.41','336.66','248.47','198.71','182.47','654.54','838.01','582.0','937.81','222.28','242.49','232.97','218.89','2487.74','514.51','398.05','121.19','101.66','388.05','617.89','545.3','266.22','126.03','220.5','1.1','289.15','1140.6','1051.86','162.15','940.34','3644.94','374.7','252.25','293.42','477.41','325.01','373.57','434.04','253.65','2811.86','1212.1','430.52','7332.82','nan','nan','nan','nan','nan','nan','nan','nan',]
var change = ['4.0400085','0.47999954','-6.349991','-11.090027','0.9300003','0.11000013','1.6200104','-1.1600037','0.6399994','0.09500122','-0.13000107','0.42001343','0.049999237','-0.32000065','-0.11999893','0.14000034','1.2799988','-4.6900024','0.480011','0.47000122','-0.45000076','-0.16000366','0.060000062','-0.2800026','-0.029999733','2.1699982','0.23999786','2.6399994','0.0','-0.15000153','-0.03999996','0.0','-0.40999985','0.69999695','-2.380005','-0.2650032','-0.10000229','1.4899979','-1.3600006','0.069999695','0.59000015','1.390007','0.020000458','0.30000114','1.3199997','2.9300003','3.159996','-1.2699966','0.42000008','0.95000076','0.25999832','0.07999802','-0.099998474','0.29999924','0.59000015','0.0','-0.030000687','2.2599945','-1.949997','0.29000092','-0.0099983215','0.0','-0.08000183','-1.1699829','1.0100021','4.529999','6.8399963','1.949997','0.9399986','-0.03999901','0.3299942','0.20999908','0.070007324','0.829998','0.0','1.2800007','2.0299988','2.1900024','1.2200012','0.21000099','0.3900032','-1.0','0.6000061','0.31000042','1.2200012','1.140007','-0.34999847','-2.209999','0.020004272','-0.08000183','-0.47999954','-0.010002136','0.69999695','2.709999','1.329998','-1.3200073','0.75','0.29000092','0.40999985','-5.899994','0.069999695','-6.9699974','-4.069992','0.20000076','0.33000183','0.15999985','1.0999985','0.29000092','-0.010000229','0.19999981','0.5','0.030006409','0.27000046','1.0599976','-0.020000458','0.88000107','0.02999878','-0.13000488','2.3499985','1.1499939','1.5499954','0.060001373','-0.13000107','0.040000916','0.710001','0.98999786','-1.0899963','0.29000092','-2.3899994','0.5100002','-0.17000008','0.42000008','0.21000099','-12.76001','0.8499985','1.1800232','-2.1100006','0.63000107','0.12999916','0.08000183','0.44999695','-1.2200012','-2.2799988','0.030002594','0.34000015','-1.0099945','-0.5299988','0.40000153','1.300003','0.26000023','-13.369995','-5.639984','-2.5800018','0.58000183','1.9799957','3.4599915','0.05000305','1.9599991','0.1800003','3.5899963','-0.029999733','0.6300049','0.15000153','0.7799988','-2.8499908','0.05000305','1.0299988','1.1800003','0.020004272','-23.359985','0.13000107','2.2299957','-0.009994507','0.030002594','-1.3300018','0.22000122','-0.29000854','0.31000137','5.4799957','0.44000244','0.4300003','0.48999786','0.07999992','0.030002594','0.049999237','0.6399994','14.929993','4.540001','4.2899933','6.600006','0.5','-0.09000015','0.05000305','2.0700073','-0.08000183','0.16999817','-0.16000366','-0.6399994','0.29000092','2.0999908','0.63000107','1.3200073','0.90999985','-6.1799927','0.9399948','0.019996643','-0.22000122','-0.41999817','0.8600006','0.0699997','-1.1100006','7.710022','-4.4799957','1.4299927','3.0100098','3.9799957','0.11000061','0.59000015','0.0','0.58999634','-20.449951','0.69999695','1.7099991','-0.42999268','2.5699997','-8.079987','-0.1499939','2.9799805','5.970001','2.3799896','-0.4300003','2.1299973','0.29999924','0.710003','0.5300007','3.2299957','-2.199997','2.2600021','5.330017','-0.11000061','0.010002136','2.300003','-0.19000244','-0.7299957','0.40999603','-0.0099983215','3.7399902','0.11000061','-0.15999985','0.44000244','-0.29000092','0.069999695','0.6399994','0.02999878','-0.29000092','-1.7799988','-0.31000137','0.58999634','0.65999603','3.6899948','-0.15000153','1.0100098','10.429993','1.5699997','-1.5599976','1.1099854','-0.019996643','2.3700104','1.6999817','0.30999756','2.4800034','0.94999695','-0.36999512','1.3199997','1.9899902','0.76000977','2.2399979','0.34999847','-6.3399963','-0.9699936','2.6600037','0.19999695','0.34999847','2.199997','2.869995','6.3099976','3.0399933','1.8899994','-0.040008545','5.75','0.040000916','2.5299988','0.30999756','3.60999','-0.3500061','1.2000046','-1.6100006','-0.8899994','0.62999725','-0.91000366','-1.9099884','0.84000397','0.670002','0.47999573','-3.0699997','-0.58999634','-0.12000275','0.099998474','-0.38000488','1.050003','3.0','0.31999207','1.9700012','0.5299988','-0.070007324','0.10000229','-0.0399971','0.099990845','1.2799988','0.14999771','12.860016','3.3900146','0.7900009','2.2599945','0.08000183','1.0499954','0.8200073','4.399994','0.65999985','-1.5800018','2.119995','1.5','0.7899971','-16.710022','2.319992','1.0','3.430008','8.660034','-3.1400146','-2.0400085','0.8500061','1.4400024','0.6100006','0.21999931','3.7100067','-0.22999573','1.4799957','0.3500061','0.83000183','-0.95999146','-3.7999878','2.9100037','0.58999634','0.6049957','1.1900024','-0.12999725','2.7599945','0.48999786','1.0','-8.089996','0.47999954','0.02999878','0.40000153','-3.850006','-7.3900146','1.5899963','5.25','-0.70999146','0.97999954','-16.700012','0.5700073','4.699997','-13.26001','0.29000092','0.7400055','3.9199982','0.42999268','17.990005','1.4100037','2.8299866','3.050003','0.7400055','0.5200043','-2.2099915','3.380005','1.75','0.6000061','-1.5699768','-0.5400009','2.6600037','-1.5599976','0.51000214','-5.299988','5.529999','-0.08999634','1.1799927','0.8800049','1.1300049','1.1800079','0.8400116','0.15999985','0.019996643','1.1699982','-0.02999878','2.1700134','11.109985','0.8199997','-1.0700073','1.340004','-0.8899994','4.220001','1.9300079','0.049999237','1.4400024','-0.22999573','0.33000183','1.24001','3.3600006','3.5','0.66999817','1.0300064','-4.5899963','0.6499939','-1.0699997','3.369995','4.669998','4.8099976','0.52000046','0.44999695','-0.1000061','2.6799927','-0.38000488','0.08001709','0.3600006','4.48999','6.0200043','5.8900146','1.8200073','1.4300003','0.45999908','-5.119995','0.6200104','0.27000427','3.5299988','1.9300003','2.5','-13.2300415','0.47999573','6.019989','-1.34','-0.83999634','1.8699951','0.3600006','-2.0800018','8.969971','1.6000366','-1.3900146','1.4799805','2.6399994','0.41999817','2.630005','0.66999817','16.889893','5.980011','1.0599976','0.9200058','1.8600006','-2.0200195','2.2700195','-0.59002686','0.29000854','0.26999664','2.9100037','-0.100000024','0.16000366','5.5200195','-3.7600098','-0.5200043','-5.299988','19.939941','3.3400269','8.149994','1.9200134','0.010009766','6.2900085','6.8900146','3.630005','1.0299988','7.880127','25.130005','3.1299744','165.91992','nan','nan','nan','nan','nan','nan','nan','nan',]
var unit_prices = ['177.21','11.64','173.15','696.3','26.66','5.64','186.86','169.39','14.24','42.7','16.3','144.65','32.92','14.18','17.66','15.76','47.95','464.0','145.96','50.31','44.94','405.88','1.29','41.39','12.4','62.03','37.6','96.92','380.78','54.38','9.22','10.06','48.52','102.07','86.83','48.47','59.96','39.02','59.71','31.11','28.86','66.5','16.7','17.06','72.44','99.5','92.5','77.03','16.5','22.12','56.0','40.58','17.87','33.48','57.39','15.27','14.0','155.83','54.86','36.83','31.49','40.05','53.1','742.0','76.87','64.43','141.71','206.02','39.26','28.35','82.86','85.62','144.5','33.44','36.29','29.78','171.65','86.13','55.26','22.43','40.93','45.69','174.61','11.67','39.86','77.83','84.06','85.59','152.5','75.31','62.36','37.25','126.605','97.15','41.35','282.97','158.305','33.62','53.03','325.4','25.6','52.1','150.0','29.55','64.68','33.37','52.75','34.83','16.42','15.61','171.45','91.63','17.82','51.44','59.05','53.22','218.71','137.68','111.82','168.79','110.88','28.49','34.52','91.45','30.01','87.08','116.74','51.75','170.99','19.72','25.18','29.9','31.32','428.76','73.755','274.8','58.4','40.5','24.23','32.84','96.5','57.8','287.94','38.88','55.83','161.88','159.17','44.51','63.56','19.22','303.14','370.52','140.9','35.7','220.98','145.8','54.9','81.72','44.88','127.53','8.06','192.54','65.78','58.06','193.21','36.95','92.74','38.54','69.46','625.58','35.42','110.0','183.55','38.49','148.0','67.08','205.44','53.97','116.2','32.37','76.76','50.12','27.46','32.11','34.12','43.7','414.89','95.65','109.8','137.49','32.25','61.44','53.72','105.44','58.39','32.88','68.77','121.22','29.75','142.66','42.74','323.19','16.1','564.12','126.0','86.43','102.94','126.72','93.74','69.1','50.37','503.94','171.4','87.5','238.9','127.76','21.26','33.08','35.75','76.2','1263.57','86.04','66.21','80.74','98.6','272.98','68.08','390.29','192.0','245.69','65.45','72.47','26.25','35.24','24.35','246.64','145.33','101.06','361.45','56.34','61.26','120.35','95.09','82.47','67.72','49.5','455.36','217.8','53.68','104.46','69.86','104.63','57.81','74.61','38.7','104.54','25.52','145.63','102.72','121.81','99.38','188.5','242.24','58.5','152.5','354.85','100.4','150.4','270.3','44.66','124.0','193.93','711.23','93.29','152.92','140.76','125.25','42.71','267.35','106.58','142.1','88.6','120.93','189.47','389.21','322.0','132.65','227.1','144.14','385.26','75.93','249.4','77.83','235.46','90.1','65.92','196.41','134.78','74.0','167.96','182.0','70.97','58.47','74.0','104.03','142.76','72.41','89.34','117.73','91.23','128.91','135.47','383.02','244.23','212.73','49.15','34.59','133.39','107.72','47.58','276.5','304.5','67.95','192.25','82.75','88.08','77.49','195.85','62.32','249.09','81.87','96.67','46.38','561.27','137.98','121.36','195.6','552.49','344.49','204.82','83.26','93.94','190.29','26.6','241.0','135.54','252.51','154.5','159.96','182.23','310.63','140.05','80.2','136.72','72.52','125.0','170.0','43.59','217.0','433.13','56.35','111.5','87.63','298.24','788.88','246.96','421.98','132.83','61.21','852.9','206.99','210.0','616.37','103.63','108.62','202.14','173.41','256.59','164.43','232.56','140.03','124.53','156.45','237.15','248.49','451.79','66.67','272.03','78.68','164.35','243.59','68.42','644.59','322.0','147.4','75.39','77.5','77.17','139.19','134.13','29.24','72.6','254.07','220.16','266.1','417.0','85.89','511.08','110.98','80.94','295.3','229.87','51.87','125.0','230.85','111.8','64.95','113.88','490.33','162.94','108.0','290.87','400.0','112.08','145.71','206.77','784.93','25.25','162.41','178.27','509.69','503.71','324.91','80.01','274.15','220.69','442.0','154.22','110.65','105.79','575.96','198.43','67.65','416.36','120.18','195.71','650.63','167.96','351.56','182.98','337.82','247.5','199.05','185.69','649.33','842.64','586.93','940.0','219.77','241.15','229.48','218.4','2480.43','507.99','397.57','119.87','99.74','390.07','618.01','548.37','265.78','125.05','217.58','0.5','290.29','1141.67','1054.62','162.18','947.6','3635.0','373.35','244.71','291.5','477.78','319.8','366.62','431.69','253.13','2799.83','1185.98','429.98','7240.0','nan','nan','nan','nan','nan','nan','nan','nan',]
var total_sales = ['186.49','12.1','173.88','697.5399','27.725','5.963','189.31','170.71','14.95','42.778','16.33','145.35','33.36','14.46','17.77','16.13','49.98','467.12','146.74','50.61','44.94','407.97','1.38','41.57','12.5075','63.73','38.6699','99.32','381.28','54.97','9.31','10.25','49.12','103.04','87.19','48.605','60.05','40.22','59.795','31.235','29.62','67.56','16.73','17.505','74.165','102.63','95.7','77.3688','17.09','23.16','56.58','40.71','18.14','33.74','58.405','15.495','14.17','158.73','56.03','37.15','31.91','40.51','53.5699','742.0','77.8679','66.02','146.428','210.6399','40.2762','28.55','83.4','86.55','144.81','34.21','36.49','31.045','173.96','88.83','56.38','22.8','41.5','45.75','175.87','12.02','41.295','78.93','84.22','85.66','153.54','75.48','62.88','37.345','127.52','101.1','42.735','284.68','159.07','34.145','54.02','326.96','25.79','57.33','151.43','30.015','64.83','33.63','53.93','35.085','16.65','15.965','171.8252','91.8567','18.175','52.365','59.24','54.15','219.98','138.39','114.5099','169.95','112.45','28.9','34.58','92.6689','30.77','87.84','116.95','52.415','172.71','20.46','25.315','30.56','31.805','430.99','76.39','276.88','58.67','41.205','24.585','33.17','97.2299','58.38','288.64','39.6867','56.455','162.36','159.7','45.27','65.34','19.58','303.93','371.71','143.035','36.43','225.42','150.05','55.325','85.09','45.3922','130.75','8.285','194.065','66.42','59.27','193.21','37.07','93.85','39.73','69.72','626.46','35.93','112.98','184.68','39.0','149.52','67.68','207.08','54.78','119.94','32.985','77.475','50.5','27.75','32.195','34.62','44.71','421.0','100.1033','114.03','144.76','32.74','61.66','54.005','107.84','58.785','33.41','69.36','122.21','30.35','144.45','44.14','327.43','17.14','566.3399','128.17','87.66','103.5','127.15','94.38','70.67','51.18','510.94','173.325','89.86','243.78','131.495','21.4','34.28','35.995','77.3916','1272.1099','86.765','68.54','81.2','100.32','273.27','68.375','393.93','196.51','248.46','65.56','74.575','26.63','36.45','24.695','250.82','145.63','103.08','368.42','56.78','62.04','122.6','95.41','82.47','68.715','49.8','460.56','219.92','53.94','104.95','70.225','105.0','58.485','75.17','39.07','104.54','25.88','147.315','103.86','124.98','99.83','189.66','251.57','59.94','152.795','358.0','101.3','152.79','272.315','45.56','126.81','194.8','712.475','95.01','154.38','141.79','127.62','43.19','267.35','107.055','146.12','89.46','121.78','192.57','394.165','329.27','136.1','230.0','146.195','389.79','77.31','251.8','78.63','240.69','90.63','67.89','196.595','135.45','75.18','167.96','182.62','72.3','59.32','75.82','104.35','142.76','73.06','90.3739','119.52','91.98','133.2895','135.84','386.8218','245.7502','213.5925','49.9','34.81','134.83','108.72','48.015','293.92','308.06','68.8','194.78','83.57','89.92','78.64','200.27','63.795','249.62','83.92','97.79','47.135','563.589','139.9','122.89','199.22','560.5','344.94','204.82','84.655','95.56','192.64','26.95','245.88','136.08','255.72','155.535','161.19','183.32','312.49','143.93','81.79','138.71','73.755','125.11','172.97','44.1','219.75','466.03','57.078','111.96','87.885','299.73','789.1','249.665','429.02','134.55','62.69','857.395','207.76','215.58','616.37','104.42','109.185','206.29','173.75','269.42','167.68','234.975','143.21','126.05','157.855','237.87','253.5','454.52','67.6','272.95','79.2','166.72','245.365','69.37','645.34','332.85','148.84','76.33','78.48','78.4591','141.38','134.97','29.55','73.17','254.89','221.64','267.79','427.64','86.4','515.575','112.84','81.315','301.035','232.56','52.15','127.46','231.82','112.835','66.715','117.56','495.79','164.94','109.49','292.145','406.14','112.82','149.73','212.33','788.0','25.705','163.76','178.875','511.58','504.16','326.955','80.68','279.685','226.285','449.92','155.97','112.87','108.14','579.6799','199.245','68.22','424.98','121.93','199.07','650.63','169.6','359.07','182.77','339.79','248.75','200.65','185.81','654.54','846.03','586.93','945.455','223.18','243.5','233.29','220.07','2497.78','515.54','398.28','121.445','102.33','392.455','619.915','548.37','267.53','126.45','221.18','1.19','291.57','1142.55','1056.32','163.5','947.6','3660.2','375.44','252.84','294.5','480.2947','325.725','373.78','434.18','253.9895','2820.0','1223.94','431.38','7338.11','nan','nan','nan','nan','nan','nan','nan','nan',]
var sales_change_30d = ['177.11','11.62','165.5','663.0','26.57','5.57','186.7695','167.65','14.21','42.14','16.145','143.19','32.88','13.755','17.55','15.555','47.58','453.03','144.52','49.785','44.14','402.91','1.29','40.95','12.245','61.62','37.6','96.79','380.545','54.105','9.155','10.01','48.01','101.57','83.72','47.82','59.68','38.93','58.0','30.92','28.79','65.89','16.6','16.865','72.44','99.13','92.35','74.9','16.28','22.01','55.51','40.305','17.725','33.08','57.15','15.26','13.93','155.6','54.25','36.65','31.08','39.92','52.79','691.1','76.71','63.62','141.35','203.89','39.04','28.145','82.21','85.62','142.4299','33.235','35.8705','29.63','169.77','85.0','55.04','22.3','40.735','44.9','173.76','11.645','39.71','77.76','83.38','83.005','151.81','74.57','61.67','37.05','126.07','95.74','41.31','281.54','157.87','33.46','52.815','314.75','25.49','52.0','145.13','29.38','64.08','33.19','52.6','34.55','16.37','15.58','169.9525','91.05','17.69','51.225','58.255','53.05','212.24','136.58','111.72','168.34','110.195','28.35','34.195','91.19','29.82','86.87','114.98','51.31','167.5001','19.68','25.05','29.7417','31.21','410.8','71.48','274.03','55.18','40.5','24.1','32.7','96.035','56.595','281.91','38.54','55.755','160.59','157.33','44.34','63.47','19.13','288.84','362.4','137.43','35.69','218.84','145.64','54.885','81.46','44.54','126.925','8.0','192.04','65.655','57.93','189.03','36.95','92.4','38.475','68.97','604.67','35.33','109.675','183.04','38.33','145.85','66.94','204.0','53.87','115.73','32.25','76.41','49.76','27.4','31.95','33.91','43.6','411.36','95.15','109.6','137.25','32.16','60.5','53.47','105.01','58.18','32.7','68.6','119.56','29.73','141.455','42.45','319.07','16.0358','554.37','125.75','86.32','102.31','125.72','93.03','69.145','49.0','502.45','166.44','86.67','238.71','127.19','21.14','33.0','35.63','75.69','1211.94','85.5','64.32','80.305','98.01','262.13','67.67','390.0','190.87','244.415','65.06','72.13','26.25','35.16','24.24','246.64','141.445','100.97','359.0201','56.27','61.17','119.96','94.75','81.11','67.54','49.36','455.36','216.22','53.13','103.55','69.58','103.63','57.66','73.27','38.3','101.54','24.92','145.02','102.67','120.47','98.7','187.7','236.0','57.69','149.14','354.3001','99.945','150.0','267.96','44.65','123.73','191.93','704.4203','93.1','150.63','140.11','125.25','42.06','259.85','104.72','141.21','88.58','120.59','189.15','388.14','321.52','131.075','226.1','143.38','384.245','75.58','248.52','77.65','235.13','89.48','65.865','193.61','133.03','73.56','163.79','179.905','70.585','58.3','74.0','100.69','141.28','72.405','89.21','117.27','90.86','128.83','134.57','383.0','242.83','212.34','48.92','34.0','133.25','106.6755','47.39','276.0176','303.89','67.845','191.95','82.03','87.5704','77.47','195.72','62.04','247.125','81.82','96.225','46.078','534.2101','137.98','120.61','195.36','551.45','338.9','202.4','83.22','93.58','186.07','26.44','239.96','133.64','251.52','153.0','159.5','181.07','304.97','138.39','80.17','135.79','72.3','123.655','170.0','43.59','217.0','431.0','56.19','110.84','86.77','289.74','765.8822','246.01','420.36','130.64','61.02','823.8','205.22','209.125','595.86','103.12','108.08','200.23','172.49','256.59','163.94','230.55','139.5607','124.26','156.02','233.815','248.02','449.72','65.9415','268.6','78.02','164.01','239.975','68.0638','630.95','316.44','146.33','75.1','77.5','77.095','138.91','133.52','29.03','72.41','252.7','214.85','264.64','415.0','85.37','504.39','110.825','80.37','293.71','229.2','51.51','124.86','229.39','111.8','64.56','113.21','486.47','160.63','107.75','285.22','396.37','110.54','145.5','206.27','778.76','25.25','161.55','176.02','505.03','496.1','321.46','79.59','273.93','219.31','440.94','153.8401','110.605','105.53','562.075','196.805','67.495','413.56','120.06','194.71','622.96','167.63','346.35','178.52','332.26','246.77','198.28','181.725','645.0','835.39','579.34','927.52','219.77','241.15','229.48','217.085','2464.915','504.49','394.77','119.44','99.482','386.1','614.47','541.87','265.025','125.05','217.36','0.3','284.995','1127.83','1045.865','161.23','934.22','3608.175','372.075','243.96','291.5','474.81','319.305','366.62','430.41','251.89','2792.97','1185.98','425.59','7209.12','nan','nan','nan','nan','nan','nan','nan','nan',]
var curr_price = ['185.1','12.07','167.88','682.23','27.5','5.77','189.3','169.15','14.9','42.74','16.24','144.1','33.04','13.9','17.61','15.97','49.26','454.72','145.41','49.98','44.42','405.49','1.35','41.1','12.37','63.71','38.03','99.29','381.02','54.35','9.18','10.07','48.29','102.25','84.6','48.01','59.94','40.17','58.46','31.11','29.39','67.48','16.69','17.44','73.76','102.61','95.67','76.32','16.95','23.11','56.23','40.6','17.86','33.66','57.57','15.28','13.99','158.06','54.31','37.02','31.54','40.1','53.26','705.03','77.72','65.74','145.92','208.58','40.18','28.29','83.24','86.1','144.1','34.16','36.25','31.03','173.29','88.25','56.34','22.53','41.08','44.99','175.1','11.89','41.23','78.73','83.74','83.25','152.35','75.25','61.89','37.21','126.88','100.51','42.66','284.65','158.96','33.91','53.37','316.07','25.69','53.45','146.21','29.83','64.79','33.47','53.75','34.82','16.5','15.88','171.42','91.66','18.08','52.17','58.45','54.04','218.05','137.58','114.0','169.81','111.52','28.62','34.3','92.28','30.52','87.74','115.3','52.09','168.7','20.25','25.08','30.35','31.62','416.13','74.92','276.76','55.39','41.0','24.32','32.99','97.1','57.25','285.83','38.9','56.32','161.0','158.37','45.09','64.83','19.47','290.28','364.7','137.83','36.04','223.0','149.29','55.06','84.19','44.69','130.5','8.06','193.64','65.96','58.98','189.71','36.99','93.76','39.71','69.48','607.14','35.56','111.88','183.41','38.79','145.91','67.4','205.65','54.43','119.56','32.81','77.23','50.48','27.61','32.04','34.23','44.36','415.56','100.03','113.02','143.39','32.72','61.62','53.74','107.66','58.44','33.14','68.77','120.57','30.09','144.43','43.38','322.72','16.95','555.88','127.27','86.53','102.77','126.33','94.26','69.52','49.25','510.67','166.64','88.84','241.32','131.01','21.35','34.07','35.81','76.92','1222.65','86.2','67.38','80.41','100.06','264.89','67.94','393.74','196.14','248.2','65.13','74.17','26.63','35.99','24.68','249.87','143.03','103.05','366.35','56.47','61.29','122.19','95.06','81.55','68.38','49.66','460.5','218.12','53.52','104.07','69.76','104.23','58.43','74.85','38.37','102.57','25.31','146.05','103.39','124.92','99.45','189.21','251.54','59.63','150.94','356.25','100.16','151.99','271.12','45.1','126.26','194.62','710.79','94.47','153.7','141.55','127.6','43.14','259.98','105.66','144.89','89.0','121.33','191.67','388.9','327.58','135.86','228.05','144.26','389.69','76.14','250.81','78.34','238.68','89.7','67.05','194.78','134.35','74.84','166.08','180.27','71.83','59.18','74.52','101.06','142.16','72.45','89.77','117.63','91.94','132.21','135.26','384.99','244.76','213.01','49.24','34.72','134.31','108.61','47.76','288.44','307.88','68.78','194.5','82.61','89.34','78.41','199.95','63.31','247.67','83.88','97.75','47.12','542.43','139.89','122.52','197.66','560.28','339.77','202.78','84.19','95.32','190.72','26.82','245.55','135.86','255.69','154.77','160.82','181.35','306.82','139.91','80.77','137.765','73.58','124.48','172.75','44.01','218.6','461.7','56.91','111.81','87.6','292.8','777.45','248.65','426.95','132.27','62.21','834.62','207.71','215.41','601.62','104.21','108.98','206.11','173.68','268.45','165.92','233.79','142.73','125.58','157.35','234.05','251.86','453.29','67.37','270.23','78.2','166.67','243.28','68.96','635.3','330.38','147.34','76.09','78.4','78.22','141.32','134.74','29.34','72.81','253.98','221.26','267.69','425.55','86.09','506.87','112.08','80.49','300.83','231.58','51.69','126.01','230.5','112.1','66.37','117.35','493.83','163.91','109.23','286.99','398.27','111.35','147.87','211.4','787.98','25.7','163.03','177.11','511.55','502.0','325.38','80.1','278.65','225.92','448.17','155.97','112.16','106.81','567.0','198.85','68.08','421.58','121.81','198.44','632.98','168.89','357.12','180.41','336.66','248.47','198.71','182.47','654.54','838.01','582.0','937.81','222.28','242.49','232.97','218.89','2487.74','514.51','398.05','121.19','101.66','388.05','617.89','545.3','266.22','126.03','220.5','1.1','289.15','1140.6','1051.86','162.15','940.34','3644.94','374.7','252.25','293.42','477.41','325.01','373.57','434.04','253.65','2811.86','1212.1','430.52','7332.82','nan','nan','nan','nan','nan','nan','nan','nan',]
var store_id = ['122217420.0','83842760.0','68599346.0','67829294.0','56620818.0','50815955.0','43225255.0','39617363.0','33451475.0','33017241.0','31723129.0','28903378.0','27136443.0','22933711.0','22837251.0','22646482.0','22372946.0','21584859.0','20136414.0','18775023.0','18621319.0','18258568.0','17983608.0','17481139.0','17309827.0','17279214.0','16080721.0','16054313.0','15702662.0','14706398.0','14472245.0','14092877.0','13916191.0','13335711.0','12948193.0','12799828.0','12764878.0','12522696.0','12506678.0','12431695.0','12424927.0','12375930.0','12237717.0','12038868.0','11518007.0','11351451.0','11252582.0','11105935.0','10381089.0','10283478.0','10175539.0','9575747.0','9524505.0','9293630.0','9068147.0','9068104.0','8889847.0','8886200.0','8842745.0','8817795.0','8717623.0','8694725.0','8325093.0','8129571.0','7964964.0','7841793.0','7535431.0','7507355.0','7498359.0','7420519.0','7413748.0','7309959.0','7236875.0','7212259.0','7199184.0','7157006.0','7025518.0','7008059.0','6983366.0','6793993.0','6749751.0','6747702.0','6619046.0','6584803.0','6551272.0','6504733.0','6336184.0','6293334.0','6182285.0','6175146.0','6121241.0','6115069.0','6069135.0','5928447.0','5925782.0','5921180.0','5819055.0','5790801.0','5775221.0','5729413.0','5619969.0','5605409.0','5603264.0','5575471.0','5517550.0','5410634.0','5328499.0','5289170.0','5272678.0','5239564.0','5182346.0','5159788.0','4989882.0','4981893.0','4957302.0','4944682.0','4894878.0','4800944.0','4732067.0','4715915.0','4705100.0','4704511.0','4696243.0','4691080.0','4669377.0','4622909.0','4583411.0','4558605.0','4548251.0','4504884.0','4473495.0','4471665.0','4460726.0','4453826.0','4399945.0','4398453.0','4344206.0','4328496.0','4327925.0','4282373.0','4198008.0','4196926.0','4173373.0','4171421.0','4146629.0','4140862.0','4138678.0','4069622.0','4037306.0','4026835.0','4023163.0','4005484.0','3976439.0','3958771.0','3915157.0','3856961.0','3841619.0','3802253.0','3792378.0','3762747.0','3746255.0','3737245.0','3684076.0','3681687.0','3677326.0','3660189.0','3585029.0','3576481.0','3516823.0','3431321.0','3406639.0','3402751.0','3334534.0','3333788.0','3321118.0','3307943.0','3252389.0','3243429.0','3235743.0','3229473.0','3207462.0','3132178.0','3116166.0','3098994.0','3091420.0','3080956.0','3049835.0','3019322.0','3014078.0','3004626.0','2971901.0','2949947.0','2942834.0','2927935.0','2917591.0','2917255.0','2906136.0','2897849.0','2875121.0','2870908.0','2854864.0','2820853.0','2812115.0','2800473.0','2777049.0','2775595.0','2725718.0','2723823.0','2702856.0','2683844.0','2653582.0','2620779.0','2618381.0','2616761.0','2615982.0','2584806.0','2565374.0','2564359.0','2541100.0','2530767.0','2529965.0','2524222.0','2503417.0','2486502.0','2480660.0','2478991.0','2472186.0','2471757.0','2455616.0','2399953.0','2394683.0','2366162.0','2352337.0','2352268.0','2339378.0','2318790.0','2296709.0','2277508.0','2258520.0','2257571.0','2239925.0','2186635.0','2171576.0','2170881.0','2158228.0','2157096.0','2151130.0','2147363.0','2129580.0','2129465.0','2124120.0','2120894.0','2101762.0','2078602.0','2072380.0','2070027.0','2059910.0','2014100.0','2005574.0','1985149.0','1984198.0','1982935.0','1979992.0','1961105.0','1944821.0','1935469.0','1931589.0','1927062.0','1911368.0','1899304.0','1885678.0','1877604.0','1868771.0','1841834.0','1835201.0','1831334.0','1819506.0','1770884.0','1765806.0','1746214.0','1743069.0','1742693.0','1741513.0','1739052.0','1736106.0','1731710.0','1725778.0','1700490.0','1696895.0','1693851.0','1690590.0','1690491.0','1679761.0','1671152.0','1650820.0','1630362.0','1594185.0','1567476.0','1555683.0','1554460.0','1546508.0','1527937.0','1521896.0','1521091.0','1517521.0','1507066.0','1505192.0','1501616.0','1500109.0','1500028.0','1492251.0','1480416.0','1477972.0','1466734.0','1457907.0','1454779.0','1451859.0','1443060.0','1433882.0','1433375.0','1432105.0','1424720.0','1416537.0','1415711.0','1401727.0','1386534.0','1378794.0','1366266.0','1361479.0','1353752.0','1353672.0','1347325.0','1343547.0','1341753.0','1336061.0','1332446.0','1332433.0','1327533.0','1314376.0','1312532.0','1294958.0','1292533.0','1286090.0','1279568.0','1275067.0','1273867.0','1258335.0','1257851.0','1257197.0','1255237.0','1251304.0','1228674.0','1225491.0','1215155.0','1214354.0','1202873.0','1192911.0','1184371.0','1176782.0','1171367.0','1162929.0','1125431.0','1121368.0','1117181.0','1088764.0','1077297.0','1065441.0','1061841.0','1060940.0','1053391.0','1044815.0','1029681.0','1026896.0','1018395.0','1014007.0','1010078.0','1009194.0','998603.0','988026.0','981503.0','973713.0','969153.0','965098.0','962865.0','952210.0','951350.0','943078.0','934098.0','931052.0','924157.0','923178.0','915263.0','908582.0','905458.0','903784.0','898445.0','886667.0','847775.0','846117.0','839242.0','836620.0','833841.0','831582.0','827325.0','814472.0','810812.0','809645.0','809589.0','807652.0','789711.0','788021.0','783138.0','776633.0','763853.0','760731.0','755527.0','750381.0','734716.0','733005.0','732091.0','724134.0','707293.0','705216.0','704568.0','699075.0','698784.0','666081.0','665390.0','662970.0','643843.0','642463.0','636361.0','633079.0','621916.0','621255.0','601739.0','587863.0','585041.0','579294.0','577396.0','573338.0','563685.0','562949.0','562595.0','534045.0','533339.0','527840.0','520509.0','519965.0','510008.0','505226.0','505125.0','499120.0','489707.0','478346.0','475135.0','465256.0','460416.0','443741.0','436981.0','409408.0','408477.0','399587.0','396629.0','384979.0','371306.0','356114.0','350826.0','335393.0','330492.0','316207.0','315937.0','314286.0','312049.0','296903.0','287065.0','282387.0','279673.0','275408.0','275387.0','189045.0','187557.0','182815.0','174512.0','171362.0','167429.0','160265.0','150160.0','138592.0','137730.0','124580.0','31209.0','nan','nan','nan','nan','nan','nan','nan','nan',]
  var percent_change = []
  var xmlhttp = new XMLHttpRequest()




  


// -------------------------------------------- //


init()
function init () {
  container = document.createElement('div')
  document.body.appendChild(container)


function calc_percent ()

{
  for (var i = 0; i < 2000; i++) { //convert change dollar values into percent
      var quote_change = change[i];
      var current_price =curr_price[i];
      quote_change = (quote_change/(current_price-quote_change))*100
      quote_change = quote_change.toFixed(2);
      percent_change.push([quote_change]);
    }
}

calc_percent();

function assignLinks () //this assigns k values to the ranked link ids, so that the highest values occur at the highest chart points for each concentric ring.

  {
  var interval = 50;

  for (var i = 0; i < 12; i++) { //link ids for the innermost petal ring
    k = (i * interval )+ 25;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = 0; j < 12; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }

  var link_order_length = link_order.length;
  var stop= link_order_length + 14

  for (var i = 0; i < 14; i++) {  //link ids for the middle petal ring
    k = (i * interval )+ 25;
    k = k + 600;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = link_order_length; j < stop; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }

  var link_order_length = link_order.length;
  var stop= link_order_length + 16

  for (var i = 0; i < 16; i++) {  //link ids for the outer petal ring
    k = (i * interval )+ 25;
     k = k + 1300;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = link_order_length; j < stop; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }


}

assignLinks();


//console.log(link_order)
//console.log(symbols)



//Petal Constructor - draws outline of petal
function drawPetal (
    x,
    y,
    z,
    x0,
    y0,
    z0,
    x1,
    y1,
    z1,
    petalheight,
    ctrlpt,
    color_code,
  ) {
    var curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0 + petalheight, z0)
    )

    var points = curve.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var curve2 = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x0, y0 + petalheight, z0),
      new THREE.Vector3(x1, ctrlpt, z1),
      new THREE.Vector3(x1, y1, z1)
    )

    var points = curve2.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })

    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)
  }


  //Chart Position Arc - returns points for top of chart lines
  function chartTop (
    x,
    y,
    z,
    x0,
    y0,
    z0,
    x1,
    y1,
    z1,
    petalheight,
    ctrlpt,
    color_code
  ) {
    var curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0 + petalheight, z0)
    )

    var points1 = curve.getSpacedPoints(25)
    var geometry = new THREE.BufferGeometry().setFromPoints(points1)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var curve2 = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x0, y0 + petalheight, z0),
      new THREE.Vector3(x1, ctrlpt, z1),
      new THREE.Vector3(x1, y1, z1)
    )

    var points2 = curve2.getSpacedPoints(25)
    var geometry = new THREE.BufferGeometry().setFromPoints(points2)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var points = points1.concat(points2)
    return points
  }


  //Chart Position - draws chart lines within petal arc
  function chartPosition (x, y, z, x0, y0, z0, petalheight, ctrlpt, color_code) {
    var cPcurve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var points = cPcurve.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)
  }


//Invisible Spaghetti - add TubeGeometry objects that sheath chart lines representing active geometric links.
function invisibleSpaghetti (k, x, y, z, x0, y0, z0, petalheight, ctrlpt) {
    var link_curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var geometry = new THREE.TubeGeometry(link_curve, 8, 0.002, 4, false)  //previous values: 64, 0.004, 8,
    var material = new THREE.MeshBasicMaterial()
    var object = new THREE.Mesh(geometry, material)
    material.transparent = true
    material.opacity = 0
    object.label = k
    parentTransform.add(object)
  }

//Visible Spaghetti - visible TubeGeometry objects represent highlighted links.
function visibleSpaghetti (k, x, y, z, x0, y0, z0, petalheight, ctrlpt, color_code) {
    var link_curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var geometry = new THREE.TubeGeometry(link_curve, 16, 0.004, 4, false)  //previous values: 32, 0.004, 4,
    var material = new THREE.MeshBasicMaterial({ color: color_code })
    var object = new THREE.Mesh(geometry, material)
    material.transparent = true
    material.opacity = .7
    object.label = k
    parentTransform.add(object)
  }

//Draw Petals - draws ring of lotus petals
function drawPetalRing (segmentCount, radius, depth, color_code, chartLines, divisor){
  var geometry = new THREE.Geometry(),
  material = new THREE.LineBasicMaterial({ color: color_code })

  for (var i = 0; i <= segmentCount; i++) {
    var theta = (i / segmentCount) * Math.PI * 2
    var iota = ((i + 0.5) / segmentCount) * Math.PI * 2
    var kappa = ((i + 1) / segmentCount) * Math.PI * 2
    drawPetal(
      Math.cos(theta) * radius,
      0,
      Math.sin(theta) * radius,
      Math.cos(iota) * (radius - depth),
      0,
      Math.sin(iota) * (radius - depth),
      Math.cos(kappa) * radius,
      0,
      Math.sin(kappa) * radius,
      0.5,
      0.45,
      color_code
    )
  }
  group.add(new THREE.Line(geometry, material))


  //Draws Chart Lines 
  var geometry = new THREE.Geometry(),
    material = new THREE.LineBasicMaterial({ color: color_code })

  for (var i = 0; i < chartLines; i++) {
    var k = 0
    var theta = (i / chartLines) * Math.PI * 2
    var iota = ((i + 0.5) / chartLines) * Math.PI * 2
    var kappa = ((i + 1) / chartLines) * Math.PI * 2
    var iota0 = ((i + divisor / 2) / chartLines) * Math.PI * 2
    var kappa0 = ((i + divisor) / chartLines) * Math.PI * 2
    var modulus = i % divisor

    var base_x = Math.cos(theta) * radius
    var base_y = 0
    var base_z = Math.sin(theta) * radius
    var petalheight = 0.5
    var ctrlpt = 0 //ctrl pt for chart lines (within petal)
    var arcpt = 0.45 //ctrl pt for petal arc (outline)

    if (modulus == 0) {

//this resets chart line variables for each new petal drawn

      var chartPoint = chartTop(
        Math.cos(theta) * radius,
        0,
        Math.sin(theta) * radius,
        Math.cos(iota0) * (radius - depth),
        0,
        Math.sin(iota0) * (radius - depth),
        Math.cos(kappa0) * radius,
        base_y,
        Math.sin(kappa0) * radius,
        petalheight,
        arcpt,
        0x00769d
      )

      for (var j = 1; j <= divisor; j++) {
        k = i + j
        k=k-1
        var theta0 = (k / chartLines) * Math.PI * 2
        var base_xk = Math.cos(theta0) * radius
        var base_yk = 0
        var base_zk = Math.sin(theta0) * radius
        if (chartLines==600) {  //this ensures that each k value is unique within the lotus flower
          k=k;
          }
        if (chartLines==700) {
          k=k+600;
          }
        if (chartLines==800) {
          k=k+1300;
          }
        

        chartPosition(
          chartPoint[j].x,
          chartPoint[j].y,
          chartPoint[j].z,
          base_xk,
          base_yk,
          base_zk,
          petalheight,
          ctrlpt,
          color_code
        )

        k_values.push([    //k values each define a unique curve in 3D space. They are not associated with a specific petal ring.
          k,
          chartPoint[j].x,
          chartPoint[j].y,
          chartPoint[j].z,
          base_xk,
          base_yk,
          base_zk,
          petalheight,
          ctrlpt,
        ])
      }
    }


    geometry.vertices.push(
      new THREE.Vector3(Math.cos(theta) * radius, 0, Math.sin(theta) * radius)
    )
  }

  parentTransform = new THREE.Object3D()
  group.add(parentTransform)
  group.add(new THREE.Line(geometry, material));

}


  // -------------------------------- // 



drawPetalRing (12, .65, .1, 0x00769d, 600, 50) //center petals

drawPetalRing (14, .85, .1, 0x0289b6, 700, 50)  //middle petals

drawPetalRing (16, 1, 0,  0x0099cc, 800, 50)  //outer petals

getActiveLinks();
addLinks();
render();

document.getElementById('nowplaying').innerHTML =
      '<br><br><br><br><br>'

function getActiveLinks()  //sorts for a given set of values from the data obtained above
{

    var f = percent_change.entries();

    for (x of f) {
      var quote =x;
      var change_value = quote[1];
      var change_index = quote[0];

      if (change_value > .5 && change_value <= 1) {
        
        active_links.push(change_index);
        //console.log(change_value)
      }

      else if (change_value > 1 && change_value <= 2) {
        change_index = quote[0]
        active_links2.push(change_index);
      }
    }
}

console.log (active_links.length)
console.log (active_links2.length)

function addLinks() {  //adds links for selected values

  link_order_length = link_order.length
//  console.log(link_order_length)

for (i = 0; i < link_order_length; i++) {

    if (active_links.includes(i)) {

      var k = link_order[i];
      var color_code = 0x00A86B; 

      visibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )
    }

    if (active_links2.includes(i)) {

      var k = link_order[i];
      var color_code = 0x015c3a;

      visibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )
    }

    else

    var k = link_order[i];       

        invisibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )

  }
}


  // -- quote details code

  function showPointer () {
    document.body.style.cursor = 'pointer'
  }

  function nowPlaying (k) {
      l = link_order.indexOf(k)
      /*var unit_float=unit_prices[l]
      var unit_price = quote_float.toFixed(2);
      */
      /*if (quote_change_float > 20)
      {
        document.getElementById('nowplaying').innerHTML =
      '<b>Symbol</b><br><br>' + symbols[l] + '&nbsp; &nbsp;' + '$' + quote_price + '&nbsp; &nbsp;' + '<span style="color:#e45e9d; font-weight:bold;">' + quote_change + '%</span>'
      }
      else if (quote_change_float > 5)
            {
        document.getElementById('nowplaying').innerHTML =
      '<b>Symbol</b><br><br>' + symbols[l] + '&nbsp; &nbsp;' + '$' + quote_price + '&nbsp; &nbsp;' + '<span style="color:#ffca85; font-weight:bold;">' + quote_change + '%</span>'
            }
      else*/

      volume = store_id[l]
      volume = (new Intl.NumberFormat().format(volume));

         document.getElementById('nowplaying').innerHTML =
      '<br><br><b>Symbol</b>: ' + symbols[l] + '&nbsp; &nbsp;'
      + '<br><b>Current Price:</b> ' + '$' + curr_price[l] + '&nbsp; &nbsp;'
      + '<br><b>Change Since Previous Close:</b> ' + percent_change[l] + '%'
      + '<br><b>Volume:</b> ' + '$' + volume + '&nbsp; &nbsp;'
      + '<b>Open:</b> ' + '$' + unit_prices[l] + '&nbsp; &nbsp;' +
      '<br><b>High:</b> ' + '$' + total_sales[l] + '&nbsp; &nbsp;' + '<b>Low:</b>' + '$' + '&nbsp; &nbsp;' + sales_change_30d[l]
      /* + '<span style="color:#0099cc;">' + quote_change + '%</span>'
*/

            }

  function datestamp (date,time) {
  document.getElementById('datestamp').innerHTML =
      '<span style = "color:#00A86B; font-weight:bold; font-size: 16px;">Filter One</span>&nbsp; &nbsp; '+ active_links.length + ' links<br>' +
      '<span style = "color:#014421; font-weight:bold; font-size: 16px;">Filter Two</span>&nbsp; &nbsp; '+ active_links2.length + ' links<br>' +
      time + " &nbsp;" + date
      }


  datestamp(date,time); 


  // --- raycaster code

  raycaster = new THREE.Raycaster()

  document.addEventListener('mousemove', onDocumentMouseMove, false)
  window.addEventListener('click', onMouseClick, false)
  window.addEventListener('resize', onWindowResize, false)
  
  function onDocumentMouseMove (event) {
    event.preventDefault()
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1
    raycaster.setFromCamera(mouse, camera)

    var intersects = raycaster.intersectObjects(parentTransform.children, true)
    
    if (intersects.length > 0) {
      showPointer()
    }
    else {
      document.body.style.cursor = 'default'
      document.getElementById('nowplaying').innerHTML =
      '<br><br>'
    }

    for (var i = 0; i < intersects.length; i++) {
      var intersection = intersects[i],
      obj = intersection.object
      k = obj.label
      l = link_order.indexOf(k)   //connects the k value -- position on lotus petal graph -- to ID for link value
      nowPlaying(k)

      /*console.log(symbols[l])
      console.log(current_price[l])
      console.log(unit_prices[l])
      console.log(sales_change_30d[l])
      console.log(active_links)
      console.log(active_links2)*/
    }
  }


  function onMouseClick (event) {
    //event.preventDefault()
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1
    raycaster.setFromCamera(mouse, camera)
    var intersects = raycaster.intersectObjects(parentTransform.children, true)
    for (var i = 0; i < intersects.length; i++) {
      var intersection = intersects[i],
      obj = intersection.object
      k = obj.label
      l = link_order.indexOf(k)   //connects the k value -- position on lotus petal graph -- to ID for link value
      var URL = "https://finance.yahoo.com/quote/" + symbols[l]
      //console.log(symbols[l])
      //console.log(quote_change_1h[l])
      window.open(URL, '_blank')
    }
  }

  function onWindowResize () {
    camera.aspect = window.innerWidth / window.innerHeight
    camera.updateProjectionMatrix()
    renderer.setSize(window.innerWidth, window.innerHeight)
  }

  //animate and render

  camera.position.z = 5

  function animate () {
    requestAnimationFrame(animate)
    group.rotation.x += 0.0
    group.rotation.y += 0.0
  }
  animate()
  render()

  function render () {
    dot += 0
    renderer.render(scene, camera)
    renderer.setClearColor(0xffffff, 1)
  }
}

//  ---- reference code ----- //  


//  ---- reference code ----- //  
