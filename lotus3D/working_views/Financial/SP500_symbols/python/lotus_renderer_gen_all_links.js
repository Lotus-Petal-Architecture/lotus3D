//Copyright 2022 by Lotus.fm LLC, 2000_view

var camera, scene, raycaster, renderer, parentTransform
var mouse = new THREE.Vector2()
var r = 100,
  dot = 0

  var scene = new THREE.Scene()

  var camera = new THREE.PerspectiveCamera(  
    7.7, // This variable controls size -- the lower the value the larger the rendering. Original value was 27.
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  )

  var container = document.getElementById('container')

  containerWidth = window.innerWidth
  containerHeight = window.innerHeight

  renderer = new THREE.WebGLRenderer({ antialias: true })
  renderer.setPixelRatio(window.devicePixelRatio)
  renderer.setSize(window.innerWidth, window.innerHeight)
  document.body.appendChild(renderer.domElement)

  var controls = new THREE.OrbitControls(camera, renderer.domElement)
  controls.minDistance = 0
  controls.maxDistance = 100
  controls.maxPolarAngle = Math.PI / 2
  controls.addEventListener( 'change', () => renderer.render( scene, camera ) );


  var light = new THREE.PointLight(0xffffff)
  light.position.set(-100, 200, 100)
  scene.add(light)

  var group
  group = new THREE.Group()
  group.position.set( 0, -.08, -5);
  group.rotation.set(1,0,0);
  scene.add(group)

  var link_order_length = 0


 


  var link_order = [] // list of all link values in the module, with k values assigned to each index position
  var k_values = [] // list of all k values generated for corresponding module chart lines
  var active_links = [] //index values of active links
  var active_links2 = [] //index values of active links
var time = '10:27 EST'
var date = '2024/02/07'
var symbols = ['DISH','F','TSLA','AMD','ABMD','NVDA','AAPL','AMZN','WBD','PARA','VFC','FTNT','META','LUMN','ENPH','PFE','T','MU','GOOGL','MSFT','PYPL','BAC','INTC','CMCSA','KEY','AAL','GM','GOOG','DIS','CCL','CVS','HBAN','GILD','WFC','BMY','CSCO','VZ','AMGN','CDAY','KMI','USB','EMR','C','EW','WBA','XOM','TFC','LLY','AMCR','PCG','SLB','OXY','SEDG','RF','NCLH','CFG','FOXA','KO','CSX','SBUX','CTSH','CARR','DVN','IPG','NEM','NKE','FCX','BA','JNJ','HPQ','JPM','BKR','MO','CVX','NEE','NWSA','UAL','WRK','DAL','BSX','SCHW','LUV','UDR','COP','KDP','WMT','FITB','HPE','HAL','MRK','ON','EL','TAP','MCD','MRO','LVS','TGT','ABBV','PEP','QCOM','PPL','CHTR','GE','ORCL','KIM','TPR','CTVA','IVZ','PG','ADM','V','BAX','RTX','YUM','MS','TJX','CRM','UNH','ZION','MDT','EXC','KHC','WMB','NFLX','OTIS','VICI','CTLT','BRK-B','MMM','APTV','CL','VTRS','PRU','JCI','NWL','PM','PNC','MOS','AES','ABT','IBM','O','XYL','MCHP','APA','APD','OMC','BWA','CAT','WYNN','DD','MTCH','ALB','MDLZ','WDC','CTRA','SO','MET','UPS','ACN','ETSY','D','DLTR','GIS','AMAT','HUM','MGM','VLO','TXN','GLW','PEG','EBAY','FOX','VRTX','CPRT','TMUS','WY','PEAK','SYY','MNST','MA','EXPE','RCL','PLD','MRNA','ROL','TSN','MTB','HON','AVGO','EQT','EOG','AFL','KR','BK','APH','CZR','FMC','ANET','DOW','UNP','CDW','CMA','ADBE','HD','IP','HST','BEN','SYF','LYB','OGN','ROK','JNPR','CMG','DHR','XRAY','CNC','FIS','FAST','AXP','KMX','ALK','COST','HRL','NXPI','WM','HLT','ADI','NWS','LIN','CAG','ILMN','AIG','EIX','MAS','CINF','STT','STZ','STX','CI','HWM','CNP','A','IT','HSY','FTV','LOW','PSX','XEL','DXCM','GS','SPGI','FE','ES','DHI','NI','EQR','LW','BALL','GNRC','SPG','K','HOLX','BXP','AEP','CMI','ETN','NDAQ','OKE','DE','CEG','INVH','TT','DUK','NTRS','MPC','TXT','SRE','HES','ODFL','DOV','AMT','ISRG','CB','TMO','CPB','COF','VNO','DTE','PCAR','ICE','CBRE','MMC','DG','KMB','NOW','CME','CAH','SEE','SNPS','ROST','JKHY','TRMB','IR','TEL','FDX','HAS','FANG','CHRW','PHM','DXC','LNC','ZTS','AIZ','BBWI','VRSN','HIG','AKAM','IEX','PAYX','DFS','TTWO','BBY','TROW','ADP','ULTA','WELL','LYV','CSGP','CCI','ZBH','MCK','PAYC','EVRG','LEN','BDX','WAB','AJG','EA','PXD','J','CDNS','PFG','ARE','PGR','SHW','CLX','PPG','DGX','ORLY','LMT','WEC','NUE','SWKS','CHD','AME','RSG','LNT','ALGN','MAR','QRVO','VTR','DLR','EFX','JBHT','TRV','ALL','ADSK','ECL','SYK','CPT','TER','NSC','NOC','ELV','INCY','ED','GPN','SJM','KLAC','ETR','KEYS','CBOE','NRG','TSCO','AEE','AOS','ATO','RMD','LKQ','WST','BRO','CMS','DPZ','SWK','CF','PTC','IQV','EXR','PNR','WAT','MKC','TECH','WTW','MPWR','AON','AAP','ESS','REG','IFF','REGN','DVA','DRI','GRMN','LRCX','WHR','GD','VRSK','STE','HSIC','MHK','AWK','RJF','NTAP','BF-B','RL','MSCI','ITW','GL','BLK','MSI','MAA','WRB','GPC','HCA','MCO','INTU','BR','AVB','FFIV','PH','BKNG','IDXX','MOH','IRM','VMC','MKTX','PWR','L','ZBRA','FLT','URI','BIIB','AVY','LHX','ALLE','PSA','TDG','EMN','PNW','EXPD','EQIX','ANSS','FRT','POOL','LDOS','LH','CTAS','AMP','ROP','SBAC','PKG','MLM','RHI','CE','BIO','GWW','SBNY','EPAM','HII','CRL','FDS','SNA','AZO','MTD','TDY','UHS','COO','NDSN','TYL','TFX','NVR','TWTR','SIVB','RE','PKI','NLSN','NLOK','FRC','FISV',]
var price = ['5.77','12.4582','186.19','171.57','381.02','693.01','190.12','170.16','9.795','13.22','14.825','69.75','469.6799','1.485','120.22','27.455','17.375','84.69','145.13','411.59','64.134','32.885','43.025','43.75','13.675','14.8201','38.345','146.34','98.625','15.792','75.6','12.315','74.9903','47.9868','48.33','49.87','40.7676','303.66','69.52','16.575','39.45','103.93','54.22','87.24','23.13','101.3799','35.645','731.095','9.335','16.435','47.275','57.2699','75.01','17.76','17.34','31.0','30.145','60.09','37.33','95.52','78.045','53.49','40.8344','32.385','33.49','103.45','39.5','209.77','158.3','28.17','174.57','29.33','40.38','151.37','55.855','24.21','41.085','39.98','40.12','65.195','62.28','31.31','34.99','111.68','31.45','169.92','33.01','15.279','34.45','127.37','76.96','143.535','59.76','289.155','22.45','52.99','147.17','174.9164','172.765','145.43','25.865','286.08','138.14','116.435','20.35','40.665','53.04','15.6711','159.35','52.85','278.355','39.36','92.32','131.71','85.98','98.0193','288.24','518.86','38.93','87.81','34.02','37.02','34.1275','563.4422','92.27','29.845','58.28','397.13','93.875','81.22','84.19','11.78','107.48','53.6','8.025','91.745','148.97','29.975','16.335','113.96','183.2272','53.56','122.9325','83.57','30.255','215.5','87.895','34.11','326.41','100.31','66.405','35.44','113.52','75.565','58.41','24.175','67.35','66.96','146.125','367.92','74.0','44.645','140.81','64.555','171.89','370.8375','44.545','137.15','159.995','31.89','58.99','42.52','27.95','421.44','51.13','161.96','32.585','18.035','79.95','56.89','461.62','154.19','120.865','130.81','98.57','44.2','54.39','130.12','194.305','1249.4987','34.05','111.68','78.92','45.125','54.895','103.96','42.97','54.17','269.52','54.06','250.86','247.13','48.97','616.14','361.87','33.1996','19.445','26.48','38.2','94.4','16.32','265.18','37.145','2698.69','248.11','33.89','75.38','61.225','70.145','206.99','72.85','35.82','720.8697','29.845','222.955','189.965','197.65','191.795','25.24','421.6475','28.5','142.09','69.565','64.995','70.24','106.0','72.13','245.22','86.47','333.0','58.98','27.6','134.46','453.345','196.21','82.375','221.785','146.03','58.445','126.02','385.45','457.665','35.86','53.215','145.65','25.195','58.96','100.6','58.27','124.03','144.18','54.545','74.1','63.44','77.29','249.345','273.56','56.6','68.01','388.69','132.525','32.54','275.76','95.15','77.5','167.265','87.015','69.93','144.84','446.02','161.875','192.4','390.17','246.91','555.8','43.94','133.085','25.33','105.16','104.97','127.535','84.165','196.35','134.955','120.9337','790.08','204.44','105.06','34.705','557.48','143.6','168.7','51.9','84.17','141.42','241.75','49.4','151.62','73.54','103.515','21.355','26.925','195.92','178.075','43.645','201.19','90.03','125.05','219.09','122.04','104.6','168.925','74.72','108.96','251.2','514.345','86.45','88.77','85.11','107.52','128.04','515.6','198.71','49.71','152.85','241.52','136.0','236.61','137.27','226.2913','141.875','299.95','78.63','117.16','182.46','312.4','155.94','140.02','128.14','1058.99','428.03','78.04','184.91','103.52','101.175','167.71','175.135','47.75','287.25','248.98','109.89','44.86','144.205','244.14','213.25','214.55','158.53','259.07','202.76','341.645','94.58','97.915','252.48','451.93','498.68','58.75','89.47','136.82','132.525','608.845','99.07','158.71','184.245','53.46','236.948','68.17','79.665','111.95','189.365','47.43','411.12','79.3065','56.47','424.035','88.92','75.88','179.39','214.3975','143.32','73.83','329.195','66.37','66.225','272.06','640.0078','303.74','66.15','228.34','61.93','81.48','950.5','113.05','167.36','121.45','850.04','108.23','268.07','251.29','227.03','75.59','108.255','122.125','111.135','87.16','56.925','146.55','587.9','256.7183','122.28','791.87','328.08','124.87','80.32','142.27','308.75','404.5','643.38','199.15','172.21','182.84','515.89','3713.61','570.97','361.99','69.05','236.685','226.67','207.705','72.577','243.0','288.255','657.0245','243.97','202.885','207.525','127.11','281.34','1146.33','82.5801','68.14','126.31','841.29','339.95','101.4155','374.3499','112.5863','223.76','625.3773','390.19','548.895','219.52','164.695','525.505','79.27','148.495','322.805','951.72','1.0','287.715','266.8324','219.93','481.99','294.0','2820.5','1210.46','435.05','163.15','376.995','255.45','434.175','251.85','7437.36','nan','nan','nan','nan','nan','nan','nan','nan',]
var change = ['0.11000013','0.38820076','1.0899963','3.6900024','0.0','10.780029','0.81999207','1.0100098','-0.27499962','-0.7699995','-2.125001','2.2699966','14.9599','0.13499999','19.71','-0.045000076','-0.23500061','0.09000397','1.0299988','6.100006','0.4240036','-0.1550026','0.28499985','-0.66999817','-0.22499943','-0.07989979','0.31500244','0.9299927','-0.6650009','-0.17800045','1.8399963','-0.055000305','-2.7296982','-0.30319977','-0.9299965','-0.11000061','-0.33239746','-12.410004','0.0699997','-0.11499977','-0.6499977','9.669998','-0.12999725','-1.0100021','0.01999855','-0.8701019','-0.60499954','26.064941','0.15499973','0.1949997','-0.7349968','-0.30009842','7.630005','-0.10000038','-0.10000038','-0.5400009','-1.4750004','0.15000153','0.31000137','-0.15000153','-0.6850052','-0.8199997','-0.24560165','-0.60500336','-0.16999817','0.83999634','-0.66999817','1.1900024','0.2400055','-0.12000084','-0.5299988','-0.059999466','-0.2199974','-0.980011','-0.375','-0.47000122','-0.14500046','1.6100006','-0.060001373','0.40499878','0.3899994','0.27999878','-0.5699997','0.16000366','0.34000015','0.11000061','-0.4600029','-0.0009994507','-0.36999893','0.4900055','0.6399994','-2.675003','-1.5300026','4.505005','-0.07999992','0.8200035','2.7400055','1.6264038','1.3450012','1.3299866','0.17499924','-4.200012','0.55999756','1.1349945','0.10000038','-0.33499908','0.95000076','-0.20890045','0.3899994','-0.020000458','1.5950012','-0.34999847','0.040000916','4.44001','-0.11999512','0.9193039','2.4100037','8.189972','0.02999878','0.069999695','0.11000061','-0.18999863','-0.17250061','7.562195','0.3299942','0.01499939','-0.1800003','3.3900146','0.114997864','-2.9700012','0.45000458','-0.11000061','4.090004','0.34000015','-0.0350008','0.084999084','-0.31999207','-0.375','-0.16500092','-0.040000916','-0.1828003','-0.18999863','3.3725052','0.3199997','-0.2650013','-2.550003','-1.1050034','0.040000916','3.6900024','0.25','0.6650009','-0.6000023','0.5','0.31500244','-0.040000916','-0.14500046','-0.05000305','1.0','0.20500183','3.2200012','-0.8499985','-0.4449997','3.0449982','-0.27500153','3.1900024','4.487488','-0.14500046','-0.68000793','1.625','-0.15000153','0.010002136','-0.13999939','-1.3899994','5.3099976','0.6500015','0.9600067','-0.22500229','-0.045000076','-0.4600067','0.54999924','1.1199951','0.4900055','0.29499817','0.30999756','-1.4599991','0.19000244','-1.0','-2.1500092','0.6649933','26.848633','-0.1800003','-0.19999695','2.0','0.13499832','-0.16500092','1.1900024','-0.40999985','0.7199974','4.6299744','0.020000458','0.9900055','16.630005','-0.27999878','9.0','5.619995','0.05960083','-0.024999619','-0.14999962','-0.59000015','-0.069999695','-0.63000107','5.1999817','0.15499878','210.94995','-0.08999634','-0.27000046','0.45999908','-0.39500046','0.6649933','1.3400116','1.0199966','-0.17000198','10.079712','-0.24500084','-0.04499817','0.7549896','3.0299988','2.0849915','-0.460001','6.087494','-0.12000084','-2.800003','0.7950058','-0.1349945','1.4599991','-6.0999985','-0.3199997','-2.5399933','0.27000427','5.4200134','0.54999924','-0.010000229','-1.3999939','-8.355011','1.4300079','0.82499695','3.6650085','0.11999512','0.005001068','1.0999985','0.46002197','4.375','0.049999237','-0.5250015','2.619995','0.11499977','-0.22000122','-0.45999908','1.0200005','6.6800003','0.7899933','0.114997864','-0.069999695','0.12999725','0.05999756','-2.194992','2.4400024','0.27999878','0.069999695','-0.20999146','1.5149994','-0.1800003','5.529999','0.09000397','-0.69999695','0.625','0.92500305','0.16999817','-1.2100067','20.470001','1.0549927','0.7299957','0.480011','-0.7599945','-4.4800415','-0.42000198','-1.2649994','0.020000458','0.9500046','0.73999786','1.2050018','-0.025001526','1.8500061','0.6450043','-0.39630127','12.630005','1.6600037','0.98999786','-0.01499939','15.049988','1.4400024','4.7899933','0.2100029','0.9300003','-0.13000488','0.42999268','0.15999985','-0.37001038','-0.9799957','0.9449997','0.0049991608','0.10499954','-0.22000122','9.184998','0.50500107','2.4799957','0.33000183','0.5699997','0.19999695','-0.15000153','-1.0600052','2.255005','-0.11999512','-0.020004272','0.3899994','12.344971','-0.08000183','-0.069999695','1.2300034','-0.14000702','0.4399948','8.72998','1.050003','0.049999237','1.9100037','2.8400116','1.2599945','2.5599976','2.0100098','-1.7586975','1.9649963','7.1500244','0.22999573','-0.4699936','2.1900024','4.519989','1.1699982','0.13000488','1.8799973','7.130005','1.0799866','-0.29999542','3.5599976','0.4699936','1.0149994','1.6300049','1.4550018','-0.0099983215','-1.1900024','4.220001','1.2799988','-0.23999786','-0.054992676','0.8600006','1.8500061','1.5400085','1.1799927','5.0900116','2.8099976','1.875','-0.73999786','0.16500092','0.6199951','3.7599792','4.850006','-0.88000107','-0.29999542','0.9600067','0.31498718','7.2249756','-0.37999725','2.7400055','3.8349915','-0.060001373','3.1580048','-0.20999908','1.4449997','0.13999939','-0.875','0.31000137','12.850006','0.89649963','0.0','2.455017','-0.41999817','-0.26000214','2.2799988','-1.012497','0.5900116','0.25','-1.1849976','-0.6800003','-1.1450043','3.6099854','7.027832','2.9100037','-0.22000122','-4.630005','-0.27999878','0.7100067','12.690002','0.9700012','1.4400024','-0.3600006','15.419983','-1.0','0.38000488','2.819992','1.1100006','-0.5','1.4449997','0.31300354','-0.21499634','-0.4399948','0.01499939','-0.7899933','5.9000244','1.0282898','1.0899963','3.8900146','2.6999817','-0.7099991','-0.16999817','0.94999695','1.9299927','6.450012','8.080017','0.2999878','-0.5399933','0.36999512','4.340027','68.670166','3.9699707','4.869995','0.09000397','5.1049957','5.4100037','1.5950012','-0.23299408','0.5099945','1.2650146','2.484497','-1.5800018','4.444992','-0.18501282','1.0800018','2.6900024','5.7299805','-0.029899597','0.05999756','0.29999542','3.2799683','3.2900085','-0.24450684','0.7799072','0.42630005','1.4799957','7.4873047','2.1400146','3.5950317','0.91999817','1.6650085','10.994995','-0.83000183','0.625','-2.205017','11.379944','-0.100000024','-1.4349976','0.61239624','-0.5700073','4.57999','0.5799866','8.63501','-1.6400146','1.0099792','1.0','2.294983','1.800003','3.6549988','-0.3999939','104.54','nan','nan','nan','nan','nan','nan','nan','nan',]
var unit_prices = ['5.64','12.73','188.18','169.47','380.78','683.19','190.64','169.48','10.35','13.9','15.29','73.83','458.0','1.52','119.54','27.55','17.6','84.14','144.76','407.44','64.54','33.06','42.89','44.63','13.97','14.92','38.54','146.12','97.39','16.0','75.15','12.49','76.21','48.45','49.19','50.3','41.1','315.51','69.1','16.74','40.24','101.88','54.5','89.44','23.25','102.25','36.42','710.38','9.35','16.3','48.22','57.61','77.31','17.97','17.49','31.79','32.87','60.07','37.2','96.24','75.64','54.9','41.17','33.24','33.75','102.39','40.1','208.76','157.8','28.25','175.69','29.47','40.71','153.02','56.32','24.68','41.23','40.25','40.31','64.85','62.07','30.96','35.35','111.72','31.45','170.27','33.62','15.33','34.94','126.9','77.04','146.7','60.1','285.05','22.54','52.4','149.0','174.01','172.63','145.16','25.85','290.0','138.62','115.8','20.36','41.17','52.34','15.94','159.1','52.63','279.38','39.795','92.58','128.13','86.26','97.54','287.35','514.01','39.12','88.05','34.11','37.33','34.37','558.16','91.9','29.92','58.5','394.6','94.6','82.5','84.09','11.9','105.64','53.94','8.06','91.95','149.3','30.46','16.62','114.6','183.34','53.75','120.67','84.1','30.58','218.34','89.9','34.45','322.94','100.6','66.1','36.12','114.13','75.56','58.47','24.39','67.54','66.27','146.08','365.0','74.6','45.43','140.32','65.01','170.49','368.68','44.8','138.3','159.93','32.06','59.13','42.73','30.5','416.74','50.85','161.75','32.97','17.82','80.27','56.71','461.21','155.055','121.02','130.31','100.15','44.14','55.53','133.06','195.47','1234.0','34.37','111.92','77.37','45.05','55.13','103.03','43.65','53.51','266.08','54.25','250.74','234.84','49.63','613.25','358.48','33.45','19.55','26.68','38.88','95.0','16.85','261.49','37.1','2561.5','247.92','34.32','75.02','62.01','70.09','207.08','72.47','36.01','714.15','30.21','225.0','189.84','192.5','191.83','25.7','419.07','28.74','145.09','68.98','65.26','69.51','107.97','72.68','245.9','86.49','329.48','58.73','27.77','136.52','458.97','195.4','81.88','219.32','146.29','58.72','124.92','385.31','459.38','35.95','53.92','143.9','25.175','59.3','101.13','58.13','119.98','144.0','54.59','74.55','63.64','77.54','252.89','272.88','56.74','68.26','390.43','131.96','32.89','272.89','95.47','78.55','167.34','86.55','70.08','146.16','431.0','162.0','192.29','390.38','247.65','562.0','44.6','134.85','25.47','104.5','104.86','126.63','84.77','195.16','135.42','122.02','782.81','203.79','104.31','34.92','546.0','142.27','166.38','51.75','83.56','141.8','242.02','49.21','151.98','74.92','103.33','21.3','26.98','196.14','173.82','43.4','199.34','89.87','125.05','222.54','122.95','106.0','168.35','75.29','109.6','251.83','506.89','86.75','89.14','84.58','107.92','127.86','510.0','198.05','49.85','152.14','239.04','135.5','234.71','136.04','228.05','141.41','295.27','78.6','118.0','181.45','310.11','156.0','140.57','128.0','1055.71','426.54','78.65','182.35','104.14','100.74','166.67','174.15','48.0','288.18','246.1','109.93','45.26','145.06','244.81','212.97','213.87','157.7','256.81','201.19','340.74','95.54','98.64','252.44','448.17','497.63','59.24','90.14','136.49','132.86','609.4','99.81','157.21','182.35','53.64','235.06','68.58','79.02','113.26','190.35','47.29','408.08','78.66','56.75','421.63','90.1','76.21','178.28','216.0','142.77','73.95','330.32','67.34','67.77','270.14','641.47','302.1','66.4','232.54','62.25','80.935','940.0','112.09','166.76','121.81','837.72','110.18','269.5','249.55','226.63','76.25','107.83','122.36','111.36','87.89','57.13','147.65','585.08','256.42','121.56','790.0','328.5','125.59','80.8','141.74','307.66','401.68','640.54','199.24','172.9','183.4','515.25','3650.1','568.79','357.66','69.24','234.0','222.5','207.59','72.96','243.67','288.85','658.06','246.44','199.8','208.46','126.93','278.63','1140.36','83.0','68.44','126.96','843.71','339.73','101.82','375.24','112.33','223.77','622.1','389.09','550.0','220.06','164.56','519.8','80.23','148.25','327.74','946.7','0.5','289.14','266.62','220.81','480.0','294.87','2812.0','1216.11','436.06','162.48','376.77','255.32','433.92','252.3','7399.5','nan','nan','nan','nan','nan','nan','nan','nan',]
var total_sales = ['5.963','12.98','189.22','172.97','381.28','694.35','191.03','170.49','10.34','13.91','15.74','73.91','470.91','1.515','124.085','27.57','17.62','84.7007','145.27','411.72','64.85','33.24','43.025','44.77','14.005','15.03','39.12','146.49','98.695','16.02','77.4','12.515','76.45','48.47','49.35','50.35','41.14','315.51','70.67','16.77','40.32','104.4','54.7','89.44','23.765','102.73','36.56','740.9899','9.56','16.44','48.35','58.02','79.57','17.97','17.545','31.79','32.91','60.195','37.335','96.6593','78.06','55.32','41.45','33.24','33.75','103.71','40.115','209.96','159.37','28.25','175.87','29.68','40.7411','153.78','56.575','24.75','41.52','40.31','40.42','65.43','62.31','31.31','35.6','112.93','31.57','170.66','33.62','15.37','35.138','127.66','77.48','147.54','60.1','289.67','22.75','53.0','149.0','175.37','172.885','145.43','25.9','290.31','138.83','116.59','20.43','41.21','53.24','15.91','159.71','52.95','279.47','39.84','92.79','132.37','86.39','98.1','288.63','520.19','39.24','88.25','34.15','37.37','34.46','563.765','92.45','30.01','58.9','397.66','94.71','83.38','84.255','11.9078','107.72','53.99','8.155','92.13','149.88','30.635','16.7','114.6','183.85','53.89','123.2','84.105','30.86','219.62','90.855','34.81','327.82','100.605','66.675','36.12','115.11','75.77','58.59','24.43','67.765','66.96','146.8774','368.0','74.63','45.43','141.33','65.16','171.94','370.8375','44.98','139.39','160.29','32.12','59.23','42.88','30.5','422.66','51.1989','162.0','33.05','18.1625','80.44','56.895','461.995','156.77','121.43','130.82','100.24','44.27','55.63','132.9075','195.82','1250.52','34.51','112.84','78.92','45.18','55.18','104.05','43.75','54.46','270.155','54.39','251.63','247.63','49.74','616.18','361.87','33.495','19.585','26.66','39.0','95.0','16.89','265.82','37.2','2717.141','249.79','34.295','75.87','62.04','70.15','207.64','72.96','36.21','721.09','30.21','225.0','190.29','197.94','191.83','25.82','423.9719','28.79','145.09','69.565','65.39','70.24','108.99','72.675','246.26','86.67','333.27','59.14','27.76','136.91','458.61','196.37','82.5','221.835','147.0812','58.73','126.02','386.56','460.47','36.02','53.965','145.65','25.24','59.37','101.13','58.51','124.17','144.6','54.72','74.55','63.65','77.65','252.55','273.87','56.93','68.335','391.83','132.93','32.86','276.267','95.51','78.755','169.03','87.17','70.23','147.32','448.295','162.305','193.14','390.86','248.35','565.71','44.575','135.13','25.38','105.25','104.99','127.665','84.74','196.48','136.43','122.02','792.9699','205.535','105.19','34.83','557.9','143.78','169.14','51.9','84.445','141.97','243.28','49.46','152.8','74.955','103.75','21.415','26.99','196.5605','179.14','43.65','201.3399','90.32','125.73','221.2859','123.19','106.2','169.02','75.38','109.6','252.37','514.5','86.8','89.195','85.11','107.985','128.33','515.84','198.72','49.9','152.85','241.52','136.25','236.915','137.385','229.18','142.6299','300.0','78.89','118.345','182.525','312.405','156.27','141.03','129.36','1060.33','429.94','78.68','184.91','104.14','101.37','168.635','175.35','48.0','290.04','248.98','109.93','45.2','145.25','245.285','213.83','215.1','158.87','259.07','203.015','342.415','95.69','98.64','253.24','453.655','501.01','59.57','90.145','136.95','133.83','609.4','100.05','158.71','185.47','53.84','236.948','68.58','79.705','112.64','190.1974','47.43','412.14','79.37','56.77','427.9','90.1','76.54','179.73','216.32','143.6','74.2','331.18','67.355','67.8','272.06','642.25','304.5','66.69','232.26','62.38','81.51','951.19','113.3025','168.12','121.835','850.04','110.32','269.5','251.59','227.5','76.25','108.6','123.0','111.645','87.98','57.25','147.88','588.79','257.655','122.3','792.27','328.915','125.89','80.8516','142.595','310.15','404.77','643.57','200.1232','173.58','183.62','517.505','3719.88','571.59','363.24','69.205','236.825','226.67','208.29','72.995','245.58','289.0','658.28','246.44','203.25','208.8528','127.11','281.3499','1149.5813','83.2775','68.65','127.0','843.71','340.0','102.0','375.24','112.895','224.14','625.985','390.19','550.6069','220.58','164.77','526.125','80.235','148.495','326.355','952.39','1.1','288.27','267.94','220.01','483.19','294.52','2822.57','1213.395','435.6','163.26','377.27','255.48','435.5','252.3','7437.36','nan','nan','nan','nan','nan','nan','nan','nan',]
var sales_change_30d = ['5.57','12.2','182.68','168.2','380.545','676.0','188.61','169.25','9.63','13.075','14.702','68.4','456.1773','1.4','114.701','27.34','17.33','82.47','143.925','407.4','62.85','32.63','42.6301','43.585','13.43','14.75','38.105','145.2103','96.64','15.66','75.06','12.13','73.94','47.45','48.025','49.46','40.71','302.63','69.145','16.52','38.865','100.3','53.77','82.53','22.83','101.18','35.15','707.03','9.3','16.25','47.1','57.07','71.1579','17.425','17.105','30.27','30.09','59.97','37.1','95.12','75.42','53.23','40.69','31.95','33.41','102.38','39.265','208.0','157.8','27.915','174.16','29.165','40.32','151.17','55.63','23.72','40.8375','39.78','39.8471','64.785','61.69','30.82','34.445','111.46','31.2','169.85','32.54','15.185','34.36','126.5','75.11','141.6','59.2','284.11','22.3801','52.265','146.45','173.32','172.12','143.63','25.7','283.675','137.93','115.3','20.15','40.12','52.34','15.47','159.07','52.28','277.1','39.35','92.0617','128.13','85.27','97.45','285.2','512.69','38.12','87.615','33.66','36.875','34.12','554.98','91.77','29.6','58.17','394.36','93.61','81.155','83.865','11.69','103.28','53.345','7.96','91.25','146.3','29.815','16.15','113.58','182.625','53.3026','120.59','82.415','30.17','214.62','86.73','33.99','321.1','99.16','65.74','34.935','111.495','75.235','58.055','24.145','67.02','66.02','145.0901','364.115','72.6419','44.475','139.8','64.54','168.8346','365.66','44.34','137.0','158.625','31.855','58.63','42.265','27.89','416.74','50.58','160.8','32.49','17.85','79.7067','56.22','459.6263','151.09','119.89','129.435','97.88','43.62','54.175','128.31','193.91','1226.7135','34.02','111.12','77.4','44.9601','54.66','102.67','42.77','53.3725','264.758','53.7','249.77','233.69','47.81','610.15','357.72','33.06','19.225','26.23','38.04','93.92','16.24','261.39','37.05','2505.0','246.23','33.54','74.86','60.84','69.58','205.64','71.78','35.5797','712.01','29.78','218.61','189.07','191.29','189.0','24.79','419.07','28.465','139.93','68.935','64.62','69.415','105.92','71.71','241.17','85.33','328.755','58.585','27.455','133.96','450.15','194.94','81.845','218.88','145.77','58.14','124.275','382.54','453.63','35.65','53.015','143.91','24.98','58.535','99.2763','57.495','119.22','142.45','54.39','73.61','62.97','76.77','247.23','271.145','56.42','67.81','387.1','130.81','32.33','272.02','94.785','76.87','167.11','86.23','69.62','144.67','430.805','161.05','191.3','385.72','246.74','554.1375','43.9','132.32','24.89','103.99','103.92','126.36','83.305','194.73','134.8101','120.74','782.6032','203.04','104.23','34.1','546.0','141.4','163.0','51.21','83.375','140.85','241.09','48.88','151.25','73.19','102.78','21.145','26.585','195.21','172.85','42.79','198.442','89.725','124.15','212.96','121.65','104.08','167.51','74.25','107.795','250.015','504.575','85.63','88.01','83.92','106.995','127.455','509.01','191.98','49.37','151.81','238.8','135.16','232.6669','135.78','225.845','141.0','294.855','78.24','115.995','180.68','309.49','155.17','139.92','127.59','1050.48','426.93','77.75','182.391','101.8','99.97','166.12','173.26','47.45','282.59','245.12','107.96','44.72','143.34','240.17','211.16','213.165','157.535','255.185','200.5','338.23','93.65','96.31','251.97','449.6','496.65','58.415','89.275','135.2856','132.39','599.17','98.75','156.33','182.91','53.375','234.31','67.94','78.92','110.6375','187.4','47.04','404.0','78.4','56.23','419.48','88.73','75.68','177.515','212.8','142.19','73.38','324.28','66.28','66.0','267.32','630.19','300.82','65.2','225.8','61.8','80.735','933.46','111.735','166.69','121.002','833.22','107.95','267.945','248.1','225.72','75.425','107.48','121.52','110.395','86.785','56.495','146.0','578.3501','255.6688','121.59','786.53','326.8','123.77','80.24','141.24','307.715','399.34','636.975','197.51','171.05','180.94','511.84','3646.3152','562.105','356.47','68.555','233.81','220.645','206.2','72.53','240.41','286.29','649.775','242.62','198.775','207.225','126.08','278.335','1140.4963','82.39','67.7','126.14','834.94','337.02','100.835','369.93','111.95','222.7','620.59','386.709','546.81','217.89','163.29','518.46','79.03','147.07','321.62','944.165','0.5','284.4','266.295','217.895','477.915','293.31','2809.6','1204.49','431.48','162.15','374.0','253.3824','430.69','250.675','7332.585','nan','nan','nan','nan','nan','nan','nan','nan',]
var curr_price = ['5.77','12.4582','186.19','171.57','381.02','693.01','190.12','170.16','9.795','13.22','14.825','69.75','469.6799','1.485','120.22','27.455','17.375','84.69','145.13','411.59','64.134','32.885','43.025','43.75','13.675','14.8201','38.345','146.34','98.625','15.792','75.6','12.315','74.9903','47.9868','48.33','49.87','40.7676','303.66','69.52','16.575','39.45','103.93','54.22','87.24','23.13','101.3799','35.645','731.095','9.335','16.435','47.275','57.2699','75.01','17.76','17.34','31.0','30.145','60.09','37.33','95.52','78.045','53.49','40.8344','32.385','33.49','103.45','39.5','209.77','158.3','28.17','174.57','29.33','40.38','151.37','55.855','24.21','41.085','39.98','40.12','65.195','62.28','31.31','34.99','111.68','31.45','169.92','33.01','15.279','34.45','127.37','76.96','143.535','59.76','289.155','22.45','52.99','147.17','174.9164','172.765','145.43','25.865','286.08','138.14','116.435','20.35','40.665','53.04','15.6711','159.35','52.85','278.355','39.36','92.32','131.71','85.98','98.0193','288.24','518.86','38.93','87.81','34.02','37.02','34.1275','563.4422','92.27','29.845','58.28','397.13','93.875','81.22','84.19','11.78','107.48','53.6','8.025','91.745','148.97','29.975','16.335','113.96','183.2272','53.56','122.9325','83.57','30.255','215.5','87.895','34.11','326.41','100.31','66.405','35.44','113.52','75.565','58.41','24.175','67.35','66.96','146.125','367.92','74.0','44.645','140.81','64.555','171.89','370.8375','44.545','137.15','159.995','31.89','58.99','42.52','27.95','421.44','51.13','161.96','32.585','18.035','79.95','56.89','461.62','154.19','120.865','130.81','98.57','44.2','54.39','130.12','194.305','1249.4987','34.05','111.68','78.92','45.125','54.895','103.96','42.97','54.17','269.52','54.06','250.86','247.13','48.97','616.14','361.87','33.1996','19.445','26.48','38.2','94.4','16.32','265.18','37.145','2698.69','248.11','33.89','75.38','61.225','70.145','206.99','72.85','35.82','720.8697','29.845','222.955','189.965','197.65','191.795','25.24','421.6475','28.5','142.09','69.565','64.995','70.24','106.0','72.13','245.22','86.47','333.0','58.98','27.6','134.46','453.345','196.21','82.375','221.785','146.03','58.445','126.02','385.45','457.665','35.86','53.215','145.65','25.195','58.96','100.6','58.27','124.03','144.18','54.545','74.1','63.44','77.29','249.345','273.56','56.6','68.01','388.69','132.525','32.54','275.76','95.15','77.5','167.265','87.015','69.93','144.84','446.02','161.875','192.4','390.17','246.91','555.8','43.94','133.085','25.33','105.16','104.97','127.535','84.165','196.35','134.955','120.9337','790.08','204.44','105.06','34.705','557.48','143.6','168.7','51.9','84.17','141.42','241.75','49.4','151.62','73.54','103.515','21.355','26.925','195.92','178.075','43.645','201.19','90.03','125.05','219.09','122.04','104.6','168.925','74.72','108.96','251.2','514.345','86.45','88.77','85.11','107.52','128.04','515.6','198.71','49.71','152.85','241.52','136.0','236.61','137.27','226.2913','141.875','299.95','78.63','117.16','182.46','312.4','155.94','140.02','128.14','1058.99','428.03','78.04','184.91','103.52','101.175','167.71','175.135','47.75','287.25','248.98','109.89','44.86','144.205','244.14','213.25','214.55','158.53','259.07','202.76','341.645','94.58','97.915','252.48','451.93','498.68','58.75','89.47','136.82','132.525','608.845','99.07','158.71','184.245','53.46','236.948','68.17','79.665','111.95','189.365','47.43','411.12','79.3065','56.47','424.035','88.92','75.88','179.39','214.3975','143.32','73.83','329.195','66.37','66.225','272.06','640.0078','303.74','66.15','228.34','61.93','81.48','950.5','113.05','167.36','121.45','850.04','108.23','268.07','251.29','227.03','75.59','108.255','122.125','111.135','87.16','56.925','146.55','587.9','256.7183','122.28','791.87','328.08','124.87','80.32','142.27','308.75','404.5','643.38','199.15','172.21','182.84','515.89','3713.61','570.97','361.99','69.05','236.685','226.67','207.705','72.577','243.0','288.255','657.0245','243.97','202.885','207.525','127.11','281.34','1146.33','82.5801','68.14','126.31','841.29','339.95','101.4155','374.3499','112.5863','223.76','625.3773','390.19','548.895','219.52','164.695','525.505','79.27','148.495','322.805','951.72','1.0','287.715','266.8324','219.93','481.99','294.0','2820.5','1210.46','435.05','163.15','376.995','255.45','434.175','251.85','7437.36','nan','nan','nan','nan','nan','nan','nan','nan',]
var store_id = ['50815955.0','49995753.0','37684145.0','16145508.0','15702662.0','14828186.0','12763232.0','12150873.0','9656064.0','9095392.0','9002449.0','8649018.0','8149343.0','8022993.0','7456042.0','6624354.0','6168416.0','6075395.0','5976072.0','5875809.0','5783571.0','5612112.0','5610650.0','5423688.0','5124240.0','4933079.0','4715042.0','4393886.0','4192593.0','4092757.0','4048002.0','3873825.0','3463409.0','3211193.0','3108158.0','2878249.0','2843968.0','2770802.0','2683844.0','2661839.0','2640125.0','2585013.0','2545997.0','2484291.0','2482207.0','2344872.0','2316951.0','2313328.0','2220731.0','2143654.0','2083111.0','2081607.0','2081501.0','1989109.0','1914683.0','1770694.0','1753221.0','1560338.0','1560188.0','1529836.0','1524873.0','1505606.0','1500082.0','1449234.0','1443002.0','1428269.0','1421102.0','1368296.0','1325732.0','1271244.0','1242906.0','1211262.0','1208627.0','1183653.0','1183123.0','1165971.0','1160977.0','1152009.0','1148953.0','1137206.0','1114414.0','1102798.0','1095296.0','1069493.0','1062986.0','1062499.0','1032634.0','1030047.0','1025721.0','1025309.0','1015212.0','1001442.0','990580.0','977614.0','976319.0','967612.0','966734.0','957236.0','919664.0','909314.0','906139.0','905200.0','901167.0','900103.0','871469.0','871206.0','869802.0','848995.0','845266.0','831998.0','821951.0','821274.0','818580.0','805879.0','788475.0','787824.0','766872.0','765256.0','762906.0','754629.0','754376.0','752228.0','751985.0','749108.0','734268.0','725626.0','723801.0','717980.0','706761.0','699387.0','696196.0','693959.0','690874.0','690111.0','689209.0','685608.0','679988.0','678051.0','671392.0','654009.0','640892.0','636484.0','634094.0','631177.0','627924.0','626717.0','623667.0','620242.0','615513.0','615151.0','609824.0','607976.0','585420.0','576389.0','571613.0','567240.0','564507.0','561412.0','560931.0','550387.0','539549.0','538152.0','533740.0','530574.0','524562.0','520141.0','520002.0','519472.0','514126.0','507178.0','506742.0','498376.0','493443.0','482828.0','477171.0','471792.0','467727.0','464053.0','461927.0','460694.0','458519.0','449815.0','445400.0','443196.0','442235.0','429492.0','426801.0','424700.0','422845.0','418181.0','415596.0','411855.0','410613.0','409087.0','402660.0','402482.0','399863.0','399530.0','395389.0','394109.0','389444.0','386831.0','385744.0','382497.0','381816.0','381451.0','378121.0','375190.0','374503.0','372970.0','370761.0','370485.0','369111.0','365241.0','362841.0','357303.0','350278.0','349236.0','348914.0','348545.0','344871.0','341903.0','338039.0','336516.0','335560.0','330710.0','329877.0','327479.0','325987.0','323878.0','323469.0','320885.0','319989.0','315773.0','315239.0','312135.0','310312.0','309448.0','308801.0','307726.0','302437.0','301940.0','301901.0','299549.0','297236.0','296353.0','295592.0','291619.0','287529.0','287440.0','285900.0','284709.0','284607.0','282838.0','282036.0','278629.0','272300.0','271709.0','270146.0','269531.0','265402.0','261629.0','258690.0','253308.0','249706.0','249005.0','246326.0','244272.0','243935.0','242844.0','240929.0','240526.0','238985.0','238822.0','238519.0','236381.0','236350.0','235965.0','234245.0','233095.0','232136.0','230941.0','229582.0','226315.0','225308.0','221889.0','221652.0','220787.0','213190.0','211314.0','210502.0','210047.0','209862.0','209860.0','209431.0','208329.0','207519.0','205378.0','205125.0','205061.0','204592.0','202358.0','201688.0','199346.0','195985.0','195844.0','195720.0','194547.0','193459.0','192045.0','190591.0','190548.0','186515.0','183026.0','180959.0','179745.0','178466.0','178394.0','178093.0','177948.0','177315.0','176741.0','175938.0','175428.0','174164.0','174004.0','173799.0','173449.0','173353.0','172909.0','171322.0','171175.0','170736.0','170407.0','166623.0','165535.0','165377.0','163596.0','163286.0','162385.0','161493.0','159152.0','158644.0','156694.0','154764.0','154533.0','153500.0','153069.0','151452.0','151177.0','150793.0','150781.0','150425.0','149722.0','148256.0','148070.0','145908.0','145699.0','145186.0','143864.0','142903.0','142240.0','141531.0','140746.0','138833.0','133600.0','131848.0','127294.0','126601.0','126337.0','126143.0','126106.0','125672.0','125662.0','124656.0','124605.0','124472.0','123598.0','122095.0','122071.0','121979.0','118337.0','117866.0','117679.0','116566.0','116554.0','116484.0','116265.0','115905.0','113199.0','111567.0','110768.0','109445.0','109331.0','108390.0','106058.0','105739.0','105700.0','105360.0','105047.0','104600.0','104413.0','103942.0','102333.0','101756.0','101722.0','101342.0','100595.0','100517.0','100066.0','99645.0','98875.0','97688.0','97443.0','96808.0','94278.0','93926.0','93902.0','93365.0','92741.0','91537.0','91400.0','91189.0','90182.0','88544.0','87880.0','87529.0','86496.0','85988.0','85635.0','84069.0','83326.0','83319.0','82245.0','82142.0','81178.0','79654.0','75971.0','75707.0','73612.0','72490.0','72441.0','72025.0','71766.0','71748.0','71460.0','70848.0','69789.0','68343.0','68102.0','66254.0','65683.0','64901.0','64327.0','63847.0','63669.0','63141.0','59113.0','54545.0','54183.0','53473.0','50186.0','49151.0','49079.0','48248.0','45501.0','45404.0','45179.0','45130.0','44697.0','43002.0','41952.0','38447.0','37541.0','36847.0','36228.0','36136.0','35803.0','28811.0','23253.0','22255.0','21340.0','19850.0','19101.0','18053.0','17921.0','16843.0','14826.0','12612.0','10475.0','9293.0','3673.0','nan','nan','nan','nan','nan','nan','nan','nan',]
  var percent_change = []
  var xmlhttp = new XMLHttpRequest()




  


// -------------------------------------------- //


init()
function init () {
  container = document.createElement('div')
  document.body.appendChild(container)


function calc_percent ()

{
  for (var i = 0; i < 2000; i++) { //convert change dollar values into percent
      var quote_change = change[i];
      var current_price =curr_price[i];
      quote_change = (quote_change/(current_price-quote_change))*100
      quote_change = quote_change.toFixed(2);
      percent_change.push([quote_change]);
    }
}

calc_percent();

function assignLinks () //this assigns k values to the ranked link ids, so that the highest values occur at the highest chart points for each concentric ring.

  {
  var interval = 50;

  for (var i = 0; i < 12; i++) { //link ids for the innermost petal ring
    k = (i * interval )+ 25;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = 0; j < 12; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }

  var link_order_length = link_order.length;
  var stop= link_order_length + 14

  for (var i = 0; i < 14; i++) {  //link ids for the middle petal ring
    k = (i * interval )+ 25;
    k = k + 600;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = link_order_length; j < stop; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }

  var link_order_length = link_order.length;
  var stop= link_order_length + 16

  for (var i = 0; i < 16; i++) {  //link ids for the outer petal ring
    k = (i * interval )+ 25;
     k = k + 1300;
    link_order.push([k]);
  }
  for (var h = 0; h < 24; h++) {
    for (var j = link_order_length; j < stop; j++) {
      k = link_order[j];
      k1 = k - 2 - h;
      k2 = k - (-1) + h;
      link_order.push(k1);
      link_order.push(k2);
    }
  }


}

assignLinks();


//console.log(link_order)
//console.log(symbols)



//Petal Constructor - draws outline of petal
function drawPetal (
    x,
    y,
    z,
    x0,
    y0,
    z0,
    x1,
    y1,
    z1,
    petalheight,
    ctrlpt,
    color_code,
  ) {
    var curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0 + petalheight, z0)
    )

    var points = curve.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var curve2 = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x0, y0 + petalheight, z0),
      new THREE.Vector3(x1, ctrlpt, z1),
      new THREE.Vector3(x1, y1, z1)
    )

    var points = curve2.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })

    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)
  }


  //Chart Position Arc - returns points for top of chart lines
  function chartTop (
    x,
    y,
    z,
    x0,
    y0,
    z0,
    x1,
    y1,
    z1,
    petalheight,
    ctrlpt,
    color_code
  ) {
    var curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0 + petalheight, z0)
    )

    var points1 = curve.getSpacedPoints(25)
    var geometry = new THREE.BufferGeometry().setFromPoints(points1)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var curve2 = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x0, y0 + petalheight, z0),
      new THREE.Vector3(x1, ctrlpt, z1),
      new THREE.Vector3(x1, y1, z1)
    )

    var points2 = curve2.getSpacedPoints(25)
    var geometry = new THREE.BufferGeometry().setFromPoints(points2)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)

    var points = points1.concat(points2)
    return points
  }


  //Chart Position - draws chart lines within petal arc
  function chartPosition (x, y, z, x0, y0, z0, petalheight, ctrlpt, color_code) {
    var cPcurve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var points = cPcurve.getPoints(50)
    var geometry = new THREE.BufferGeometry().setFromPoints(points)
    var material = new THREE.LineBasicMaterial({ color: color_code })
    var curveObject = new THREE.Line(geometry, material)
    group.add(curveObject)
  }


//Invisible Spaghetti - add TubeGeometry objects that sheath chart lines representing active geometric links.
function invisibleSpaghetti (k, x, y, z, x0, y0, z0, petalheight, ctrlpt) {
    var link_curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var geometry = new THREE.TubeGeometry(link_curve, 8, 0.002, 4, false)  //previous values: 64, 0.004, 8,
    var material = new THREE.MeshBasicMaterial()
    var object = new THREE.Mesh(geometry, material)
    material.transparent = true
    material.opacity = 0
    object.label = k
    parentTransform.add(object)
  }

//Visible Spaghetti - visible TubeGeometry objects represent highlighted links.
function visibleSpaghetti (k, x, y, z, x0, y0, z0, petalheight, ctrlpt, color_code) {
    var link_curve = new THREE.QuadraticBezierCurve3(
      new THREE.Vector3(x, y, z),
      new THREE.Vector3(x, ctrlpt, z),
      new THREE.Vector3(x0, y0, z0)
    )

    var geometry = new THREE.TubeGeometry(link_curve, 16, 0.004, 4, false)  //previous values: 32, 0.004, 4,
    var material = new THREE.MeshBasicMaterial({ color: color_code })
    var object = new THREE.Mesh(geometry, material)
    material.transparent = true
    material.opacity = .7
    object.label = k
    parentTransform.add(object)
  }

//Draw Petals - draws ring of lotus petals
function drawPetalRing (segmentCount, radius, depth, color_code, chartLines, divisor){
  var geometry = new THREE.Geometry(),
  material = new THREE.LineBasicMaterial({ color: color_code })

  for (var i = 0; i <= segmentCount; i++) {
    var theta = (i / segmentCount) * Math.PI * 2
    var iota = ((i + 0.5) / segmentCount) * Math.PI * 2
    var kappa = ((i + 1) / segmentCount) * Math.PI * 2
    drawPetal(
      Math.cos(theta) * radius,
      0,
      Math.sin(theta) * radius,
      Math.cos(iota) * (radius - depth),
      0,
      Math.sin(iota) * (radius - depth),
      Math.cos(kappa) * radius,
      0,
      Math.sin(kappa) * radius,
      0.5,
      0.45,
      color_code
    )
  }
  group.add(new THREE.Line(geometry, material))


  //Draws Chart Lines 
  var geometry = new THREE.Geometry(),
    material = new THREE.LineBasicMaterial({ color: color_code })

  for (var i = 0; i < chartLines; i++) {
    var k = 0
    var theta = (i / chartLines) * Math.PI * 2
    var iota = ((i + 0.5) / chartLines) * Math.PI * 2
    var kappa = ((i + 1) / chartLines) * Math.PI * 2
    var iota0 = ((i + divisor / 2) / chartLines) * Math.PI * 2
    var kappa0 = ((i + divisor) / chartLines) * Math.PI * 2
    var modulus = i % divisor

    var base_x = Math.cos(theta) * radius
    var base_y = 0
    var base_z = Math.sin(theta) * radius
    var petalheight = 0.5
    var ctrlpt = 0 //ctrl pt for chart lines (within petal)
    var arcpt = 0.45 //ctrl pt for petal arc (outline)

    if (modulus == 0) {

//this resets chart line variables for each new petal drawn

      var chartPoint = chartTop(
        Math.cos(theta) * radius,
        0,
        Math.sin(theta) * radius,
        Math.cos(iota0) * (radius - depth),
        0,
        Math.sin(iota0) * (radius - depth),
        Math.cos(kappa0) * radius,
        base_y,
        Math.sin(kappa0) * radius,
        petalheight,
        arcpt,
        0x00769d
      )

      for (var j = 1; j <= divisor; j++) {
        k = i + j
        k=k-1
        var theta0 = (k / chartLines) * Math.PI * 2
        var base_xk = Math.cos(theta0) * radius
        var base_yk = 0
        var base_zk = Math.sin(theta0) * radius
        if (chartLines==600) {  //this ensures that each k value is unique within the lotus flower
          k=k;
          }
        if (chartLines==700) {
          k=k+600;
          }
        if (chartLines==800) {
          k=k+1300;
          }
        

        chartPosition(
          chartPoint[j].x,
          chartPoint[j].y,
          chartPoint[j].z,
          base_xk,
          base_yk,
          base_zk,
          petalheight,
          ctrlpt,
          color_code
        )

        k_values.push([    //k values each define a unique curve in 3D space. They are not associated with a specific petal ring.
          k,
          chartPoint[j].x,
          chartPoint[j].y,
          chartPoint[j].z,
          base_xk,
          base_yk,
          base_zk,
          petalheight,
          ctrlpt,
        ])
      }
    }


    geometry.vertices.push(
      new THREE.Vector3(Math.cos(theta) * radius, 0, Math.sin(theta) * radius)
    )
  }

  parentTransform = new THREE.Object3D()
  group.add(parentTransform)
  group.add(new THREE.Line(geometry, material));

}


  // -------------------------------- // 



drawPetalRing (12, .65, .1, 0x00769d, 600, 50) //center petals

drawPetalRing (14, .85, .1, 0x0289b6, 700, 50)  //middle petals

drawPetalRing (16, 1, 0,  0x0099cc, 800, 50)  //outer petals

getActiveLinks();

var percent_up = (active_links.length)/5
var percent_down = (active_links2.length)/5

console.log(percent_up)


addLinks(percent_up);
render();

document.getElementById('nowplaying').innerHTML =
      '<br><br><br><br><br>'

function getActiveLinks()  //sorts for a given set of values from the data obtained above
{

    var f = percent_change.entries();

    for (x of f) {
      var quote =x;
      var change_value = quote[1];
      var change_index = quote[0];

      if (change_value >= uptrend) {
        
        active_links.push(change_index);
        //console.log(change_value)
      }

      else if (change_value < downtrend) {
        change_index = quote[0]
        active_links2.push(change_index);
      }
    }
}



function addLinks(percent_up) {  //adds links for selected values

  link_order_length = link_order.length
//  console.log(link_order_length)

for (i = 0; i < link_order_length; i++) {

    if (active_links.includes(i)) {

      var k = link_order[i];
      
      if (percent_up < 50) 

      {
        var color_code = 0xfa8072;
      }

      else color_code = 0x00A86B;

      visibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )
    }

    if (active_links2.includes(i)) {

      var k = link_order[i];

      if (percent_up < 50) 

      {
        var color_code = 0xbd4840;
      }

      else color_code = 0x015c3a;

      visibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )
    }

    else

    var k = link_order[i];       

        invisibleSpaghetti(
        k,
        k_values[k][1],
        k_values[k][2],
        k_values[k][3],
        k_values[k][4],
        k_values[k][5],
        k_values[k][6],
        k_values[k][7],
        k_values[k][8],
        color_code
      )

  }
}


  // -- quote details code

  function showPointer () {
    document.body.style.cursor = 'pointer'
  }

  function nowPlaying (k) {
      l = link_order.indexOf(k)
      /*var unit_float=unit_prices[l]
      var unit_price = quote_float.toFixed(2);
      */
      /*if (quote_change_float > 20)
      {
        document.getElementById('nowplaying').innerHTML =
      '<b>Symbol</b><br><br>' + symbols[l] + '&nbsp; &nbsp;' + '$' + quote_price + '&nbsp; &nbsp;' + '<span style="color:#e45e9d; font-weight:bold;">' + quote_change + '%</span>'
      }
      else if (quote_change_float > 5)
            {
        document.getElementById('nowplaying').innerHTML =
      '<b>Symbol</b><br><br>' + symbols[l] + '&nbsp; &nbsp;' + '$' + quote_price + '&nbsp; &nbsp;' + '<span style="color:#ffca85; font-weight:bold;">' + quote_change + '%</span>'
            }
      else*/

      volume = store_id[l]
      volume = (new Intl.NumberFormat().format(volume));

         document.getElementById('nowplaying').innerHTML =
      '<br><br><b>Symbol</b>: ' + symbols[l] + '&nbsp; &nbsp;'
      + '<br><b>Current Price:</b> ' + '$' + curr_price[l] + '&nbsp; &nbsp;'
      + '<br><b>Change Since Previous Close:</b> ' + percent_change[l] + '%'
      + '<br><b>Volume:</b> ' + '$' + volume + '&nbsp; &nbsp;'
      + '<b>Open:</b> ' + '$' + unit_prices[l] + '&nbsp; &nbsp;' +
      '<br><b>High:</b> ' + '$' + total_sales[l] + '&nbsp; &nbsp;' + '<b>Low:</b>' + '$' + '&nbsp; &nbsp;' + sales_change_30d[l]
      /* + '<span style="color:#0099cc;">' + quote_change + '%</span>'
*/

            }

  function datestamp (date,time) {
  document.getElementById('datestamp').innerHTML =
      '<b>Trending Up:</b> &nbsp;'+ percent_up + '%<br>' +
      '<b>Trending Down:</b> &nbsp;'+ percent_down + '%<br>' +
      time + " &nbsp;" + date
      }

  datestamp(date,time); 


  // --- raycaster code

  raycaster = new THREE.Raycaster()

  document.addEventListener('mousemove', onDocumentMouseMove, false)
  window.addEventListener('click', onMouseClick, false)
  window.addEventListener('resize', onWindowResize, false)
  
  function onDocumentMouseMove (event) {
    event.preventDefault()
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1
    raycaster.setFromCamera(mouse, camera)

    var intersects = raycaster.intersectObjects(parentTransform.children, true)
    
    if (intersects.length > 0) {
      showPointer()
    }
    else {
      document.body.style.cursor = 'default'
      document.getElementById('nowplaying').innerHTML =
      '<br><br>'
    }

    for (var i = 0; i < intersects.length; i++) {
      var intersection = intersects[i],
      obj = intersection.object
      k = obj.label
      l = link_order.indexOf(k)   //connects the k value -- position on lotus petal graph -- to ID for link value
      nowPlaying(k)

      /*console.log(symbols[l])
      console.log(current_price[l])
      console.log(unit_prices[l])
      console.log(sales_change_30d[l])
      console.log(active_links)
      console.log(active_links2)*/
    }
  }


  function onMouseClick (event) {
    //event.preventDefault()
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1
    raycaster.setFromCamera(mouse, camera)
    var intersects = raycaster.intersectObjects(parentTransform.children, true)
    for (var i = 0; i < intersects.length; i++) {
      var intersection = intersects[i],
      obj = intersection.object
      k = obj.label
      l = link_order.indexOf(k)   //connects the k value -- position on lotus petal graph -- to ID for link value
      var URL = "https://finance.yahoo.com/quote/" + symbols[l]
      //console.log(symbols[l])
      //console.log(quote_change_1h[l])
      window.open(URL, '_blank')
    }
  }

  function onWindowResize () {
    camera.aspect = window.innerWidth / window.innerHeight
    camera.updateProjectionMatrix()
    renderer.setSize(window.innerWidth, window.innerHeight)
  }

  //animate and render

  camera.position.z = 5

  function animate () {
    requestAnimationFrame(animate)
    group.rotation.x += 0.0
    group.rotation.y += 0.0
  }
  animate()
  render()

  function render () {
    dot += 0
    renderer.render(scene, camera)
    renderer.setClearColor(0xffffff, 1)
  }
}

//  ---- reference code ----- //  


//  ---- reference code ----- //
